{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"CARA\u2019s eMedication service Integration Guide","text":"<p>Welcome to the Integration Guide for the eMedication service of CARA\u2019s community.</p>"},{"location":"#topics","title":"Topics","text":"<ul> <li>Transactions: information about the implemented transactions.</li> <li>Workflows: description of the different workflows clients of this service can follow.</li> <li>CH EMED EPR: description of the eMedication exchange format.</li> <li>PMP-APPC: description of the policy file format.</li> <li>OIDs: relevant OIDs to be used within the scope of the eMedication service.</li> <li>Endpoints: the eMedication service endpoints available to clients.</li> </ul>"},{"location":"#reporting-issues-or-suggestions","title":"Reporting Issues or Suggestions","text":"<ul> <li>Issues or suggestions about this guide can be reported on the guide\u2019s GitHub.</li> <li>Issues or suggestions about the eMedication service can be reported here.</li> <li>CH EMED EPR issues</li> </ul>"},{"location":"#other-resources","title":"Other Resources","text":"<ul> <li>EPD by example: a repository of sample transactions, including documents and patients management, authentication etc.</li> <li>IPF: Open eHealth Integration Platform - interfaces for health-care related integration solutions.<ul> <li>IPF code: IPF provides an Apache Camel implementation of pretty much all transactions   used in the Swiss EPR.</li> <li>IPF documentation</li> </ul> </li> <li>Husky: Health Usability Key - convenience API for IHE transactions and CDA documents, as well as CH EMED EPR related FHIR.<ul> <li>Husky code</li> <li>Husky javadoc</li> <li>Husky wiki</li> </ul> </li> <li>HAPI FHIR: a Java library for FHIR.</li> </ul>"},{"location":"#upcoming-changes","title":"Upcoming Changes","text":"<p>See the upcoming changes section on this site.</p> <p>Info</p> <p>This is a work in progress. You are welcome to open issues in the  GitHub repository for any question, mistake or missing information.</p>"},{"location":"endpoints/","title":"Endpoints","text":"<p>This page lists the different endpoints available to use the e-medication service.</p>"},{"location":"endpoints/#base-url","title":"Base URL","text":"Environnement Base URL EPRIK Base URL Integration https://ws-pmp-int.cara.ch http(s?)://test.ahdis.ch/eprik-cara/camel/pmp-int Development https://ws-pmp-dev.cara.ch http(s?)://test.ahdis.ch/eprik-cara/camel/pmp-dev"},{"location":"endpoints/#pix-endpoints","title":"PIX EndPoints","text":"Transaction Path Documentation Patient Identity Feed HL7 V3 (ITI-44) <code>/pmp/services/iti44</code> ITI-44. See also the IHE documentation. PIXV3 Query (ITI-45) <code>/pmp/services/iti45</code> ITI-45. See also the IHE documentation."},{"location":"endpoints/#xds-endpoints","title":"XDS EndPoints","text":"<p>XDS transactions are available through the <code>/pmp/services</code> endpoints:</p> Transaction Path Documentation Registry Stored Query (ITI-18) <code>/pmp/services/xds/iti18</code> ITI-18 Provide and Register Document Set-b (ITI-41) <code>/pmp/services/xds/iti41</code> ITI-41 Retrieve Document Set (ITI-43) <code>/pmp/services/xds/iti43</code> ITI-43 Update Document Set (ITI-57) <code>/pmp/services/xds/iti57</code> ITI-57 Query Pharmacy Documents (CH:PHARM-1) <code>/pmp/services/cmpd/chpharm1</code> CH:PHARM-1"},{"location":"endpoints/#mhd-endpoints","title":"MHD EndPoints","text":"<p>MHD transactions are now supported, as profiled by CH EPR FHIR, and available through the <code>/pmp/fhir</code> and <code>/pmp/mhd</code> endPoints:</p> Transaction Path Comment Provide Document Bundle (ITI-65) <code>/pmp/fhir/Bundle</code> MHD equivalent to ITI-41. Find Document References (ITI-67) <code>/pmp/fhir/DocumentReference</code> MHD equivalent to ITI-18. Retrieve Document (ITI-68) <code>/pmp/mhd/iti68</code> MHD equivalent to ITI-43. Update Document Metadata (CH:MHD-1) <code>/pmp/fhir/DocumentReference</code> MHD equivalent to ITI-57. CH:PHARM-5 <code>/pmp/fhir/DocumentReference/&lt;operation&gt;</code> MHD equivalent to CH:PHARM-1. The endpoint changes depending on the CH:PHARM-5 operation, see the transaction page for details."},{"location":"endpoints/#pixm-endpoints","title":"PIXm EndPoints","text":"Transaction Path Comment Mobile Patient Identifier Cross-reference Query (ITI-83) <code>/pmp/fhir/Patient</code> REST equivalent to ITI-45 Patient Identity Feed (ITI-104) <code>/pmp/fhir/Patient</code> REST equivalent to ITI-44"},{"location":"endpoints/#audit-events","title":"Audit Events","text":"Transaction Path Documentation Record Audit Event (syslog) <code>:6514</code> ITI-20 Record Audit Event (RESTful) <code>/alpage/fhir/AuditEvent</code> ITI-20 Audit Trail Consumption (CH:ATC) <code>/alpage/fhir/AuditEvent</code> CH:ATC"},{"location":"oids/","title":"OIDs","text":"<p>This page lists some OIDs relevant to the eMedication service.</p>"},{"location":"oids/#emedication-service","title":"eMedication Service","text":"OID Description Environment 2.16.756.5.30.1.1625 Root OID for the eMedication service assigned by Refdata. N/A 2.16.756.5.30.1.1625.3.1 Root OID of the eMedication service\u2019s aggregator. N/A 2.16.756.5.30.1.1625.3.1.1 eMedication service aggregator\u2019s application. production 2.16.756.5.30.1.1625.3.1.1.1 eMedication service\u2019s patient identification domain (assigning authority). production 2.16.756.5.30.1.1625.3.1.1.2 eMedication service\u2019s document repository. production 2.16.756.5.30.1.1625.3.1.1.3 eMedication service\u2019s ATNA repository. production 2.16.756.5.30.1.1625.3.1.2 eMedication service aggregator\u2019s application. integration 2.16.756.5.30.1.1625.3.1.2.1 eMedication service\u2019s patient identification domain (assigning authority). integration 2.16.756.5.30.1.1625.3.1.2.2 eMedication service\u2019s document repository. integration 2.16.756.5.30.1.1625.3.1.2.3 eMedication service\u2019s ATNA repository. integration 2.16.756.5.30.1.1625.3.1.3 eMedication service aggregator\u2019s application. development 2.16.756.5.30.1.1625.3.1.3.1 eMedication service\u2019s patient identification domain (assigning authority). development 2.16.756.5.30.1.1625.3.1.3.2 eMedication service\u2019s document repository. development 2.16.756.5.30.1.1625.3.1.3.3 eMedication service\u2019s ATNA repository. development"},{"location":"oids/#other-oids","title":"Other OIDs","text":"OID Description Environment 2.16.756.5.30.1.127.3.10.3 Central Compensation Office (EPR-SPID) assigning authority. production, integration, development 2.16.756.5.30.1.191 CARA\u2019s community root OID N/A 2.16.756.5.30.1.191.1.0.2.1 CARA\u2019s MPI assigning authority (patient identification). integration, development"},{"location":"appc/","title":"PMP-APPC","text":"<p>The technical specifications are available in ArtDecor. It describes elements, attributes and cardinalities and is the source from which the Schematron validator is generated.</p> <p>The current page only resumes the specifications with some comments.</p>"},{"location":"appc/#document-boilerplate","title":"Document boilerplate","text":"Document boilerplate<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;PolicySet xmlns=\"urn:oasis:names:tc:xacml:2.0:policy:schema:os\"\n           xmlns:hl7=\"urn:hl7-org:v3\"\n           PolicySetId=\"urn:uuid:e3585197-9e3d-4ca3-9583-4540a3a5b64b\"\n           PolicyCombiningAlgId=\"urn:oasis:names:tc:xacml:1.0:policy-combining-algorithm:deny-overrides\"&gt; &lt;!-- (1)! --&gt;\n  &lt;Description&gt;Test policy set&lt;/Description&gt; &lt;!-- (2)! --&gt;\n  &lt;Target&gt;\n    &lt;Resources&gt;\n      &lt;Resource&gt;\n        &lt;ResourceMatch MatchId=\"urn:hl7-org:v3:function:II-equal\"&gt;\n          &lt;AttributeValue DataType=\"urn:hl7-org:v3#II\"&gt;\n            &lt;hl7:InstanceIdentifier root=\"2.16.756.5.30.1.127.3.10.3\" extension=\"761337611932009095\"/&gt; &lt;!-- (3)! --&gt;\n          &lt;/AttributeValue&gt;\n          &lt;ResourceAttributeDesignator AttributeId=\"urn:e-health-suisse:2015:epr-spid\" DataType=\"urn:hl7-org:v3#II\"/&gt;\n        &lt;/ResourceMatch&gt;\n      &lt;/Resource&gt;\n    &lt;/Resources&gt;\n  &lt;/Target&gt;\n  &lt;!-- The rules (second-level PolicySets) go here --&gt;\n&lt;/PolicySet&gt;\n</code></pre> <ol> <li>Since we use the DenyOverrides algorithm, the order of sub-PolicySets is not important; all will be evaluated and any <code>Deny</code> will override any <code>Allow</code>. The <code>PolicySetId</code> has to be a new UUID for each new document. This is the first-level PolicySet.</li> <li>A mandatory but not-quite-useful description.</li> <li>The patient EPR-SPID.</li> </ol>"},{"location":"appc/#emergency-access","title":"Emergency access","text":"<p>Healthcare professionals that are not specifically granted access still can obtain temporary access to the patient record (i.e. break the glass). Emergency access can be granted or denied, its scope is all registered healthcare professionals. In absence of a rule in the APPC document, the emergency access is allowed. It cannot be limited in time.</p> PolicySetIdReference Description <code>urn:e-health-suisse:2022:policies:pmp:emedication-access</code> Grant access to eMedication documents <code>urn:e-health-suisse:2015:policies:exclusion-list</code> Deny access to the patient record Emergency access rule<pre><code>&lt;PolicySet PolicySetId=\"urn:uuid:29e64cce-19f6-43c4-9cc9-0227cb361ba1\"\n           PolicyCombiningAlgId=\"urn:oasis:names:tc:xacml:1.0:policy-combining-algorithm:deny-overrides\"&gt;&lt;!--(1)!--&gt;\n  &lt;Description&gt;description emergency&lt;/Description&gt;&lt;!--(2)!--&gt;\n  &lt;Target&gt;\n    &lt;Subjects&gt;\n      &lt;Subject&gt;\n        &lt;SubjectMatch MatchId=\"urn:hl7-org:v3:function:CV-equal\"&gt;\n          &lt;AttributeValue DataType=\"urn:hl7-org:v3#CV\"&gt;\n            &lt;hl7:CodedValue code=\"HCP\" \n                            codeSystem=\"2.16.756.5.30.1.127.3.10.6\"\n                            displayName=\"Healthcare professional\" /&gt;\n          &lt;/AttributeValue&gt;\n          &lt;SubjectAttributeDesignator AttributeId=\"urn:oasis:names:tc:xacml:2.0:subject:role\"\n                                      DataType=\"urn:hl7-org:v3#CV\" /&gt;\n        &lt;/SubjectMatch&gt;\n        &lt;SubjectMatch MatchId=\"urn:hl7-org:v3:function:CV-equal\"&gt;\n          &lt;AttributeValue DataType=\"urn:hl7-org:v3#CV\"&gt;\n            &lt;hl7:CodedValue code=\"EMER\"\n                            codeSystem=\"2.16.756.5.30.1.127.3.10.5\"\n                            displayName=\"Emergency Access\" /&gt;\n          &lt;/AttributeValue&gt;\n          &lt;SubjectAttributeDesignator AttributeId=\"urn:oasis:names:tc:xspa:1.0:subject:purposeofuse\"\n                                      DataType=\"urn:hl7-org:v3#CV\" /&gt;\n        &lt;/SubjectMatch&gt;\n      &lt;/Subject&gt;\n    &lt;/Subjects&gt;\n  &lt;/Target&gt;\n  &lt;PolicySetIdReference&gt;urn:e-health-suisse:2022:policies:pmp:emedication-access&lt;/PolicySetIdReference&gt;&lt;!--(3)!--&gt;\n&lt;/PolicySet&gt;\n</code></pre> <ol> <li>Don\u2019t forget to assign a random value to the <code>@PolicySetId</code>. This is a second-level PolicySet.</li> <li>This description is optional.</li> <li>Here you grant or deny emergency access to healthcare professionals.</li> </ol>"},{"location":"appc/#healthcare-professional-access","title":"Healthcare professional access","text":"<p>Healthcare professionals can be granted or denied access. It can be limited in time, with optional start and/or end dates.</p> PolicySetIdReference Description <code>urn:e-health-suisse:2022:policies:pmp:emedication-access</code> Grant access to eMedication documents <code>urn:e-health-suisse:2015:policies:exclusion-list</code> Deny access to the patient record Healthcare professional access rule<pre><code>&lt;PolicySet PolicySetId=\"urn:uuid:46a1a4c0-ed1e-439b-8da8-a523b10ce2b5\"\n           PolicyCombiningAlgId=\"urn:oasis:names:tc:xacml:1.0:policy-combining-algorithm:deny-overrides\"&gt;&lt;!--(1)!--&gt;\n  &lt;Description&gt;description hcp&lt;/Description&gt;&lt;!--(2)!--&gt;\n  &lt;Target&gt;\n    &lt;Subjects&gt;\n      &lt;Subject&gt;\n        &lt;SubjectMatch MatchId=\"urn:oasis:names:tc:xacml:1.0:function:string-equal\"&gt;\n          &lt;AttributeValue DataType=\"http://www.w3.org/2001/XMLSchema#string\"&gt;7601002860123&lt;/AttributeValue&gt;&lt;!--(3)!--&gt;\n          &lt;SubjectAttributeDesignator AttributeId=\"urn:oasis:names:tc:xacml:1.0:subject:subject-id\"\n                                      DataType=\"http://www.w3.org/2001/XMLSchema#string\"/&gt;\n        &lt;/SubjectMatch&gt;\n        &lt;SubjectMatch MatchId=\"urn:oasis:names:tc:xacml:1.0:function:string-equal\"&gt;\n          &lt;AttributeValue DataType=\"http://www.w3.org/2001/XMLSchema#string\"&gt;urn:gs1:gln&lt;/AttributeValue&gt;\n          &lt;SubjectAttributeDesignator AttributeId=\"urn:oasis:names:tc:xacml:1.0:subject:subject-id-qualifier\"\n                                      DataType=\"http://www.w3.org/2001/XMLSchema#string\"/&gt;\n        &lt;/SubjectMatch&gt;\n        &lt;SubjectMatch MatchId=\"urn:hl7-org:v3:function:CV-equal\"&gt;\n          &lt;AttributeValue DataType=\"urn:hl7-org:v3#CV\"&gt;\n            &lt;ns2:CodedValue code=\"HCP\"\n                            codeSystem=\"2.16.756.5.30.1.127.3.10.6\"\n                            displayName=\"Healthcare professional\"/&gt;\n          &lt;/AttributeValue&gt;\n          &lt;SubjectAttributeDesignator AttributeId=\"urn:oasis:names:tc:xacml:2.0:subject:role\"\n                                      DataType=\"urn:hl7-org:v3#CV\"/&gt;\n        &lt;/SubjectMatch&gt;\n        &lt;SubjectMatch MatchId=\"urn:hl7-org:v3:function:CV-equal\"&gt;\n          &lt;AttributeValue DataType=\"urn:hl7-org:v3#CV\"&gt;\n            &lt;ns2:CodedValue code=\"NORM\"\n                            codeSystem=\"2.16.756.5.30.1.127.3.10.5\"\n                            displayName=\"Normal Access\"/&gt;\n          &lt;/AttributeValue&gt;\n          &lt;SubjectAttributeDesignator AttributeId=\"urn:oasis:names:tc:xspa:1.0:subject:purposeofuse\"\n                                      DataType=\"urn:hl7-org:v3#CV\"/&gt;\n        &lt;/SubjectMatch&gt;\n      &lt;/Subject&gt;\n    &lt;/Subjects&gt;\n    &lt;Environments&gt;&lt;!--(4)!--&gt;\n      &lt;Environment&gt;\n        &lt;EnvironmentMatch MatchId=\"urn:oasis:names:tc:xacml:1.0:function:date-greater-than-or-equal\"&gt;\n          &lt;AttributeValue DataType=\"http://www.w3.org/2001/XMLSchema#date\"&gt;2020-01-01&lt;/AttributeValue&gt;\n          &lt;EnvironmentAttributeDesignator AttributeId=\"urn:oasis:names:tc:xacml:1.0:environment:current-date\"\n                                          DataType=\"http://www.w3.org/2001/XMLSchema#date\"/&gt;\n        &lt;/EnvironmentMatch&gt;\n        &lt;EnvironmentMatch MatchId=\"urn:oasis:names:tc:xacml:1.0:function:date-less-than-or-equal\"&gt;\n          &lt;AttributeValue DataType=\"http://www.w3.org/2001/XMLSchema#date\"&gt;2025-12-31&lt;/AttributeValue&gt;\n          &lt;EnvironmentAttributeDesignator AttributeId=\"urn:oasis:names:tc:xacml:1.0:environment:current-date\"\n                                          DataType=\"http://www.w3.org/2001/XMLSchema#date\"/&gt;\n        &lt;/EnvironmentMatch&gt;\n      &lt;/Environment&gt;\n    &lt;/Environments&gt;\n  &lt;/Target&gt;\n  &lt;PolicySetIdReference&gt;urn:e-health-suisse:2015:policies:exclusion-list&lt;/PolicySetIdReference&gt;&lt;!--(5)!--&gt;\n&lt;/PolicySet&gt;\n</code></pre> <ol> <li>Don\u2019t forget to assign a random value to the <code>@PolicySetId</code>. This is a second-level PolicySet.</li> <li>This description is optional.</li> <li>This is the GLN number.</li> <li>The start and end dates can be included in the optional Environments.</li> <li>Here you grant or deny access to healthcare professionals.</li> </ol>"},{"location":"appc/#group-access","title":"Group access","text":"<p>Group access rights can only be granted, not denied (because it\u2019s the default value). It can be limited in time, with optional start and/or end dates.</p> PolicySetIdReference Description <code>urn:e-health-suisse:2022:policies:pmp:emedication-access</code> Grant access to eMedication documents Group access rule<pre><code>&lt;PolicySet PolicySetId=\"urn:uuid:46a1a4c0-ed1e-439b-8da8-a523b10ce2b5\"\n           PolicyCombiningAlgId=\"urn:oasis:names:tc:xacml:1.0:policy-combining-algorithm:deny-overrides\"&gt;&lt;!--(1)!--&gt;\n  &lt;Description&gt;description group&lt;/Description&gt;&lt;!--(2)!--&gt;\n  &lt;Target&gt;\n    &lt;Subjects&gt;\n      &lt;Subject&gt;\n        &lt;SubjectMatch MatchId=\"urn:oasis:names:tc:xacml:1.0:function:anyURI-equal\"&gt;\n          &lt;AttributeValue DataType=\"http://www.w3.org/2001/XMLSchema#anyURI\"&gt;urn:oid:1.2.3&lt;/AttributeValue&gt;&lt;!--(3)!--&gt;\n          &lt;SubjectAttributeDesignator AttributeId=\"urn:oasis:names:tc:xspa:1.0:subject:organization-id\"\n                                      DataType=\"http://www.w3.org/2001/XMLSchema#anyURI\"/&gt;\n        &lt;/SubjectMatch&gt;\n        &lt;SubjectMatch MatchId=\"urn:hl7-org:v3:function:CV-equal\"&gt;\n          &lt;AttributeValue DataType=\"urn:hl7-org:v3#CV\"&gt;\n            &lt;ns2:CodedValue code=\"HCP\"\n                            codeSystem=\"2.16.756.5.30.1.127.3.10.6\"\n                            displayName=\"Healthcare professional\"/&gt;\n          &lt;/AttributeValue&gt;\n          &lt;SubjectAttributeDesignator AttributeId=\"urn:oasis:names:tc:xacml:2.0:subject:role\"\n                                      DataType=\"urn:hl7-org:v3#CV\"/&gt;\n        &lt;/SubjectMatch&gt;\n        &lt;SubjectMatch MatchId=\"urn:hl7-org:v3:function:CV-equal\"&gt;\n          &lt;AttributeValue DataType=\"urn:hl7-org:v3#CV\"&gt;\n            &lt;ns2:CodedValue code=\"NORM\"\n                            codeSystem=\"2.16.756.5.30.1.127.3.10.5\"\n                            displayName=\"Normal Access\"/&gt;\n          &lt;/AttributeValue&gt;\n          &lt;SubjectAttributeDesignator AttributeId=\"urn:oasis:names:tc:xspa:1.0:subject:purposeofuse\"\n                                      DataType=\"urn:hl7-org:v3#CV\"/&gt;\n        &lt;/SubjectMatch&gt;\n      &lt;/Subject&gt;\n    &lt;/Subjects&gt;\n    &lt;Environments&gt;&lt;!--(4)!--&gt;\n      &lt;Environment&gt;\n        &lt;EnvironmentMatch MatchId=\"urn:oasis:names:tc:xacml:1.0:function:date-greater-than-or-equal\"&gt;\n          &lt;AttributeValue DataType=\"http://www.w3.org/2001/XMLSchema#date\"&gt;2020-01-01&lt;/AttributeValue&gt;\n          &lt;EnvironmentAttributeDesignator AttributeId=\"urn:oasis:names:tc:xacml:1.0:environment:current-date\"\n                                          DataType=\"http://www.w3.org/2001/XMLSchema#date\"/&gt;\n        &lt;/EnvironmentMatch&gt;\n        &lt;EnvironmentMatch MatchId=\"urn:oasis:names:tc:xacml:1.0:function:date-less-than-or-equal\"&gt;\n          &lt;AttributeValue DataType=\"http://www.w3.org/2001/XMLSchema#date\"&gt;2025-12-31&lt;/AttributeValue&gt;\n          &lt;EnvironmentAttributeDesignator AttributeId=\"urn:oasis:names:tc:xacml:1.0:environment:current-date\"\n                                          DataType=\"http://www.w3.org/2001/XMLSchema#date\"/&gt;\n        &lt;/EnvironmentMatch&gt;\n      &lt;/Environment&gt;\n    &lt;/Environments&gt;\n  &lt;/Target&gt;\n  &lt;PolicySetIdReference&gt;urn:e-health-suisse:2015:policies:exclusion-list&lt;/PolicySetIdReference&gt;&lt;!--(5)!--&gt;\n&lt;/PolicySet&gt;\n</code></pre> <ol> <li>Don\u2019t forget to assign a random value to the <code>@PolicySetId</code>. This is a second-level PolicySet.</li> <li>This description is optional.</li> <li>This is the group OID.</li> <li>The start and end dates can be included in the optional Environments.</li> <li>Here you grant or deny access to healthcare professionals.</li> </ol>"},{"location":"appc/#representative-access","title":"Representative access","text":"<p>Representatives cannot be granted access yet because the eMedication service cannot access their database in the EPR. Representative access rights can only be granted, not denied (because it\u2019s the default value).</p>"},{"location":"appc/#access-rights-processing","title":"Access rights processing","text":"<p>The eMedication service does a bit of magic with the APPC document when it comes to evaluate its rules. Some specific rules are added. These roles cannot be targeted by custom rules, their access rights are granted by the eMedication service. The access rules processing is described in Authentication and authorization.</p>"},{"location":"appc/#example","title":"Example","text":"Full document example<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;PolicySet PolicySetId=\"urn:uuid:e3585197-9e3d-4ca3-9583-4540a3a5b64b\"\n           PolicyCombiningAlgId=\"urn:oasis:names:tc:xacml:1.0:policy-combining-algorithm:deny-overrides\"\n           xmlns=\"urn:oasis:names:tc:xacml:2.0:policy:schema:os\"\n           xmlns:hl7=\"urn:hl7-org:v3\"&gt;\n  &lt;Description&gt;Test policy set&lt;/Description&gt;&lt;!--(1)!--&gt;\n  &lt;Target&gt;\n    &lt;Resources&gt;\n      &lt;Resource&gt;\n        &lt;ResourceMatch MatchId=\"urn:hl7-org:v3:function:II-equal\"&gt;\n          &lt;AttributeValue DataType=\"urn:hl7-org:v3#II\"&gt;\n            &lt;hl7:InstanceIdentifier root=\"2.16.756.5.30.1.127.3.10.3\"\n                                    extension=\"761337611932009095\" /&gt;&lt;!--(2)!--&gt;\n          &lt;/AttributeValue&gt;\n          &lt;ResourceAttributeDesignator AttributeId=\"urn:e-health-suisse:2015:epr-spid\"\n                                       DataType=\"urn:hl7-org:v3#II\" /&gt;\n        &lt;/ResourceMatch&gt;\n      &lt;/Resource&gt;\n    &lt;/Resources&gt;\n  &lt;/Target&gt;\n  &lt;PolicySet PolicySetId=\"urn:uuid:29e64cce-19f6-43c4-9cc9-0227cb361ba1\"\n             PolicyCombiningAlgId=\"urn:oasis:names:tc:xacml:1.0:policy-combining-algorithm:deny-overrides\"&gt;\n    &lt;Target&gt;\n      &lt;Subjects&gt;\n        &lt;Subject&gt;\n          &lt;SubjectMatch MatchId=\"urn:hl7-org:v3:function:CV-equal\"&gt;\n            &lt;AttributeValue DataType=\"urn:hl7-org:v3#CV\"&gt;\n              &lt;hl7:CodedValue code=\"HCP\" \n                              codeSystem=\"2.16.756.5.30.1.127.3.10.6\"\n                              displayName=\"Healthcare professional\" /&gt;\n            &lt;/AttributeValue&gt;\n            &lt;SubjectAttributeDesignator AttributeId=\"urn:oasis:names:tc:xacml:2.0:subject:role\"\n                                        DataType=\"urn:hl7-org:v3#CV\" /&gt;\n          &lt;/SubjectMatch&gt;\n          &lt;SubjectMatch MatchId=\"urn:hl7-org:v3:function:CV-equal\"&gt;\n            &lt;AttributeValue DataType=\"urn:hl7-org:v3#CV\"&gt;\n              &lt;hl7:CodedValue code=\"EMER\"\n                              codeSystem=\"2.16.756.5.30.1.127.3.10.5\"\n                              displayName=\"Emergency Access\" /&gt;\n            &lt;/AttributeValue&gt;\n            &lt;SubjectAttributeDesignator AttributeId=\"urn:oasis:names:tc:xspa:1.0:subject:purposeofuse\"\n                                        DataType=\"urn:hl7-org:v3#CV\" /&gt;\n          &lt;/SubjectMatch&gt;\n        &lt;/Subject&gt;\n      &lt;/Subjects&gt;\n    &lt;/Target&gt;\n    &lt;PolicySetIdReference&gt;urn:e-health-suisse:2022:policies:pmp:emedication-access&lt;/PolicySetIdReference&gt;&lt;!--(3)!--&gt;\n  &lt;/PolicySet&gt;\n  &lt;PolicySet PolicySetId=\"urn:uuid:46a1a4c0-ed1e-439b-8da8-a523b10ce2b5\"\n              PolicyCombiningAlgId=\"urn:oasis:names:tc:xacml:1.0:policy-combining-algorithm:deny-overrides\"&gt;\n    &lt;Target&gt;\n      &lt;Subjects&gt;\n        &lt;Subject&gt;\n          &lt;SubjectMatch MatchId=\"urn:oasis:names:tc:xacml:1.0:function:string-equal\"&gt;\n            &lt;AttributeValue DataType=\"http://www.w3.org/2001/XMLSchema#string\"&gt;7601002860123&lt;/AttributeValue&gt;\n            &lt;SubjectAttributeDesignator AttributeId=\"urn:oasis:names:tc:xacml:1.0:subject:subject-id\"\n                                        DataType=\"http://www.w3.org/2001/XMLSchema#string\" /&gt;\n          &lt;/SubjectMatch&gt;\n          &lt;SubjectMatch MatchId=\"urn:oasis:names:tc:xacml:1.0:function:string-equal\"&gt;\n            &lt;AttributeValue DataType=\"http://www.w3.org/2001/XMLSchema#string\"&gt;urn:gs1:gln&lt;/AttributeValue&gt;\n            &lt;SubjectAttributeDesignator AttributeId=\"urn:oasis:names:tc:xacml:1.0:subject:subject-id-qualifier\" DataType=\"http://www.w3.org/2001/XMLSchema#string\" /&gt;\n          &lt;/SubjectMatch&gt;\n          &lt;SubjectMatch MatchId=\"urn:hl7-org:v3:function:CV-equal\"&gt;\n            &lt;AttributeValue DataType=\"urn:hl7-org:v3#CV\"&gt;\n              &lt;hl7:CodedValue code=\"HCP\"\n                              codeSystem=\"2.16.756.5.30.1.127.3.10.6\"\n                              displayName=\"Healthcare professional\" /&gt;\n            &lt;/AttributeValue&gt;\n            &lt;SubjectAttributeDesignator AttributeId=\"urn:oasis:names:tc:xacml:2.0:subject:role\"\n                                        DataType=\"urn:hl7-org:v3#CV\" /&gt;\n          &lt;/SubjectMatch&gt;\n          &lt;SubjectMatch MatchId=\"urn:hl7-org:v3:function:CV-equal\"&gt;\n            &lt;AttributeValue DataType=\"urn:hl7-org:v3#CV\"&gt;\n              &lt;hl7:CodedValue code=\"NORM\"\n                              codeSystem=\"2.16.756.5.30.1.127.3.10.5\"\n                              displayName=\"Normal Access\" /&gt;\n            &lt;/AttributeValue&gt;\n            &lt;SubjectAttributeDesignator AttributeId=\"urn:oasis:names:tc:xspa:1.0:subject:purposeofuse\"\n                                        DataType=\"urn:hl7-org:v3#CV\" /&gt;\n          &lt;/SubjectMatch&gt;\n        &lt;/Subject&gt;\n      &lt;/Subjects&gt;\n      &lt;Environments&gt;\n        &lt;Environment&gt;\n          &lt;EnvironmentMatch MatchId=\"urn:oasis:names:tc:xacml:1.0:function:date-greater-than-or-equal\"&gt;\n            &lt;AttributeValue DataType=\"http://www.w3.org/2001/XMLSchema#date\"&gt;2027-02-03&lt;/AttributeValue&gt;\n            &lt;EnvironmentAttributeDesignator AttributeId=\"urn:oasis:names:tc:xacml:1.0:environment:current-date\"\n                                            DataType=\"http://www.w3.org/2001/XMLSchema#date\" /&gt;\n          &lt;/EnvironmentMatch&gt;\n        &lt;/Environment&gt;\n      &lt;/Environments&gt;\n    &lt;/Target&gt;\n    &lt;PolicySetIdReference&gt;urn:e-health-suisse:2015:policies:exclusion-list&lt;/PolicySetIdReference&gt;&lt;!--(4)!--&gt;\n  &lt;/PolicySet&gt;\n  &lt;PolicySet PolicySetId=\"urn:uuid:23393af4-68aa-46d1-a807-767e80fbd112\"\n             PolicyCombiningAlgId=\"urn:oasis:names:tc:xacml:1.0:policy-combining-algorithm:deny-overrides\"&gt;\n    &lt;Target&gt;\n      &lt;Subjects&gt;\n        &lt;Subject&gt;\n          &lt;SubjectMatch MatchId=\"urn:hl7-org:v3:function:CV-equal\"&gt;\n            &lt;AttributeValue DataType=\"urn:hl7-org:v3#CV\"&gt;\n              &lt;hl7:CodedValue code=\"HCP\"\n                              codeSystem=\"2.16.756.5.30.1.127.3.10.6\"\n                              displayName=\"Healthcare professional\" /&gt;\n            &lt;/AttributeValue&gt;\n            &lt;SubjectAttributeDesignator AttributeId=\"urn:oasis:names:tc:xacml:2.0:subject:role\"\n                                        DataType=\"urn:hl7-org:v3#CV\" /&gt;\n          &lt;/SubjectMatch&gt;\n          &lt;SubjectMatch MatchId=\"urn:hl7-org:v3:function:CV-equal\"&gt;\n            &lt;AttributeValue DataType=\"urn:hl7-org:v3#CV\"&gt;\n              &lt;hl7:CodedValue code=\"NORM\"\n                              codeSystem=\"2.16.756.5.30.1.127.3.10.5\"\n                              displayName=\"Normal Access\" /&gt;\n            &lt;/AttributeValue&gt;\n            &lt;SubjectAttributeDesignator AttributeId=\"urn:oasis:names:tc:xspa:1.0:subject:purposeofuse\"\n                                        DataType=\"urn:hl7-org:v3#CV\" /&gt;\n          &lt;/SubjectMatch&gt;\n          &lt;SubjectMatch MatchId=\"urn:oasis:names:tc:xacml:1.0:function:anyURI-equal\"&gt;\n            &lt;AttributeValue DataType=\"http://www.w3.org/2001/XMLSchema#anyURI\"&gt;urn:oid:1.2.3&lt;/AttributeValue&gt;\n            &lt;SubjectAttributeDesignator AttributeId=\"urn:oasis:names:tc:xspa:1.0:subject:organization-id\"\n                                        DataType=\"http://www.w3.org/2001/XMLSchema#anyURI\" /&gt;\n          &lt;/SubjectMatch&gt;\n        &lt;/Subject&gt;\n      &lt;/Subjects&gt;\n      &lt;Environments&gt;\n        &lt;Environment&gt;\n          &lt;EnvironmentMatch MatchId=\"urn:oasis:names:tc:xacml:1.0:function:date-less-than-or-equal\"&gt;\n            &lt;AttributeValue DataType=\"http://www.w3.org/2001/XMLSchema#date\"&gt;2032-01-01&lt;/AttributeValue&gt;\n            &lt;EnvironmentAttributeDesignator AttributeId=\"urn:oasis:names:tc:xacml:1.0:environment:current-date\"\n                                            DataType=\"http://www.w3.org/2001/XMLSchema#date\" /&gt;\n          &lt;/EnvironmentMatch&gt;\n        &lt;/Environment&gt;\n      &lt;/Environments&gt;\n    &lt;/Target&gt;\n    &lt;PolicySetIdReference&gt;urn:e-health-suisse:2022:policies:pmp:emedication-access&lt;/PolicySetIdReference&gt;&lt;!--(5)!--&gt;\n  &lt;/PolicySet&gt;\n&lt;/PolicySet&gt;\n</code></pre> <ol> <li>A mandatory but not-quite-useful description.</li> <li>The EPR-SPID of the patient to whose record the rules will be applied.</li> <li>Authorizing emergency access of healthcare professionals to eMedication documents.</li> <li>Denying access to a single healthcare professional.</li> <li>Authorizing access to a group of healthcare professionals.</li> </ol>"},{"location":"emed/","title":"CH EMED EPR","text":"<p>CH EMED EPR is a FHIR implementation guide that specifies mostly the eMedication service\u2019s exchange format.</p> <p>It is built upon CH EMED (the Swiss eMedication profile), CH CORE and CH Term. In particular, CH-EMED contains a lot of documentation about the use of the profile, it is highly recommended reading it.</p> <p>Tip</p> <p>This format is the only one supported by the eMedication service since January, 2023.</p>"},{"location":"other/authorship_and_timestamps/","title":"Authorship &amp; Timestamps","text":"<p>This page contains a summary on authorship and timestamps as described by CH EMED</p>"},{"location":"other/authorship_and_timestamps/#authorship","title":"Authorship","text":"Document Author of the document (person / device) Author of the medical decision (person) Author original document; if different from the author of the medical decision (person) MTP Composition.author 1..(person 1.. | device 0..) MedicationStatement.informationSource 1.. - PRE Composition.author 1..(person 1.. | device 0..) MedicationRequest.requester 1.. - DIS Composition.author 1..(person 1.. | device 0..) MedicationDispense.performer.actor 1..MedicationAdministration.performer.actor 1.. - PADV Composition.author 1..(person 1.. | device 0..) Observation.performer 1.. - LIST Composition.author 1..(device, which dynamically generates the document) MedicationStatement.informationSource 1..MedicationRequest.requester 1..MedicationDispense.performer.actor 1..MedicationAdministration.performer.actor 1.. Observation.performer 1..MedicationStatement.extension:authorDocument 0..MedicationRequest.extension:authorDocument 0..MedicationDispense.extension:authorDocument 0..MedicationAdministration.extension:authorDocument 0..Observation.extension:authorDocument 0.. CARD Composition.author 1..(person or device) MedicationStatement.informationSource* 1.. MedicationStatement.extension:authorDocument* 0.. <p>*: The CARD is an aggregation of all medications, respectively all documents, which may have had different authors. The \u201clast author\u201d (author of the last input for this treatment) is indicated in each case.</p>"},{"location":"other/authorship_and_timestamps/#timestamps","title":"Timestamps","text":"<p>The document\u2019s creation date and time is mapped for all documents in <code>Bundle.timestamp</code> and <code>Composition.date</code>.</p> <p>It can also be specified at entry level :</p> Name Cardinality Description Default value MedicationStatement.dateAsserted (1..1) When the statement was asserted - MedicationRequest.authoredOn (1..1) When request was initially authored - MedicationDispense.whenHandedOver (1..1) When product was given out - Observation.issued (1..1) Date/Time this version was made available -\u00a0 Dosage.timing.boundsPeriod (Dosage - MedicationRequest) (0..1) Start and/or end of treatment By default, the start value will be set to the date of creation of the document specified in <code>Bundle.timestamp</code> and the end value will be null (valid ad infinitum) Dosage.timing.boundsPeriod (Dosage - MedicationStatement / MedicationDispense) (0..1) Start and/or end of treatment By default, the start value will be set to the date of creation of the document specified in <code>Bundle.timestamp</code> and the end value will be null (valid ad infinitum)"},{"location":"other/upcoming_changes/","title":"Upcoming Changes","text":"<p>Warning</p> <p>Note that possible changes on Husky or other libraries/dependencies are not listed here and it is up to integrators to keep track of them.</p>"},{"location":"other/upcoming_changes/#currently-deployed","title":"Currently Deployed","text":"<ul> <li>dev:<ul> <li>PMP (aggregator) v0.5.5 (deployed 2025-09-17), works with CH EMED EPR 2.0.0.</li> <li>ALPAGE v0.1.0 (deployed 22025-05-27)</li> </ul> </li> <li>int:<ul> <li>PMP (aggregator) v0.5.2 (deployed 2025-09-05), works with CH EMED EPR 2.0.0.</li> <li>ALPAGE v0.1.0 (deployed 2025-05-21, DB recreated)</li> </ul> </li> </ul>"},{"location":"other/upcoming_changes/#known-issues","title":"Known Issues","text":"<ul> <li>Aggregator:<ul> <li>The aggregator might accept bad ids within a treatmentplan extension. This might have implications for client traversing a PML document and relying on these ids to be good.</li> </ul> </li> </ul>"},{"location":"other/upcoming_changes/#next-release-dates","title":"Next Release Dates","text":"<ul> <li>Next CH EMED EPR version release: TBD</li> <li>Next aggregator release: TBD</li> </ul>"},{"location":"other/upcoming_changes/#relevant-changes","title":"Relevant Changes","text":""},{"location":"other/upcoming_changes/#pmp-v055","title":"PMP v0.5.5","text":"<p>This version uses a snapshot of Husky 3.2.0 which has not been yet released, and that fixes several bugs preventing PMLC PDF generation for medications for which an ingredient is specified without a known SNOMED code and for certain cases of dosages with a specified max dosage per period.</p>"},{"location":"other/upcoming_changes/#pmp-v052","title":"PMP v0.5.2","text":"<ul> <li>Relevant fixes:<ul> <li>Fixed bug preventing ITI-68 transactions from succeeding.</li> <li>Fixed bug preventing ITI-104 transactions for patients with no PMP-PID in the MPI from succeeding.</li> <li>Fixed Husky-based validation of submitted documents to the aggregator being done against CH EMED instead of CH EMED EPR, hence allowing invalid content (since CH EMED EPR is more constrained) to be submitted to the PMP. This would imply that upon generation of a PML or PMLC document, the aggregator would fail to produce a valid document, since these were correctly being validated against the CH EMED EPR specs.</li> <li>The document validator will properly check the first human author instead of simply the first author of the composition for its checks.</li> </ul> </li> <li>Made XUA signature validation stricter, when enabled.</li> <li>Misc. internal improvements and tracing and preparation for production deployment.</li> </ul>"},{"location":"other/upcoming_changes/#pmp-v050","title":"PMP v0.5.0","text":"<ul> <li>Works with the newly released CH EMED EPR 2.0.0, see the CH EMED EPR 2.0.0 changelog for detailed changes:<ul> <li>Units: <ul> <li>Added <code>Bq</code>, <code>kBq</code>, <code>MBq</code>, <code>GBq</code>, <code>nmol</code>, <code>413568008</code> (Application) and <code>246205007</code> (Quantity).</li> <li><code>{Piece}</code> has been removed, please use the SNOMED <code>246205007</code> (Quantity) code instead.</li> <li>Added concept maps to provide guidance to map to/from HCI\u2019s CdTyp9 unit codes. Please bear in mind that these are provided on a best effort basis and that they are by no means of normative value and in no way sanctioned by eHealthSuisse or any other entity.</li> <li>A new invariant has been added to all medication statement, medication request and medication dispense profiles to enforce that all dosage elements within each one of said resources uses the same unit. E.g. if the base dosage element specifies a dose of 1 tablet for the morning, then a split dosage element cannot say 2g in the evening.</li> </ul> </li> <li>PMLC:<ul> <li>Medication statements now contain a new <code>lastConsideredDocument</code> extension, always filled by the aggregator. This extension contains the identifier of the last document that was used for aggregating data resulting in this PMLC medication statement. This includes PADV comments. This extension might be of use for implementers wishing to detect whether new changes or comments have been performed on a treatment line since last import.</li> </ul> </li> <li>PML:<ul> <li>Changed medication request resources and changed medication statement resources added by the aggregator to a PML now conform to the new <code>CHEMEDEPRMedicationRequestChangedList</code> and <code>CHEMEDEPRMedicationStatementChangedList</code> profiles.</li> </ul> </li> <li>Misc:<ul> <li>Added a new warning invariant to all composition profiles that will check whether the composition title is correct according to the specified composition\u2019s language.</li> <li>Added a constraint to all base dosages (CHEMEDEPRDosage and CHEMEDEPRDosageMedicationRequest) that will result in a warning if the <code>.text</code> element is missing or blank.</li> <li>Examples have been added and some updated.</li> <li>Added a new guidance page on comments/notes.</li> <li>Fixed the <code>time-quantity-only-integer</code> constraint on the CHEMEDEPRTimeQuantity profile that was effectively preventing a structured max dose (<code>maxDosePerPeriod</code>) from being used.</li> </ul> </li> </ul> </li> <li>Added support for the following transactions:<ul> <li>CH EPR FHIR (MHD) (XUA token only, for now):<ul> <li>ITI-65 (Provide Document Bundle)</li> <li>ITI-67 (Find Document References)</li> <li>ITI-68 (Retrieve Document)</li> <li>CH:MHD-1 (Update Document Metadata)</li> <li>CH:ATC (Audit Trail Consumption)</li> </ul> </li> <li>CH:PHARM-5 (XUA token only, for now)</li> <li>PIXm (no token):<ul> <li>ITI-83 (Mobile Patient Identifier Cross-reference Query)</li> <li>ITI-104 (Patient Identity Feed)</li> </ul> </li> <li>RESTful ATNA Feed</li> </ul> </li> <li>PML documents are now properly generated for treatments containing changed medication requests or changed medication statements.</li> <li>PMLC PDF:<ul> <li>The aggregator allows clients to request the PMLC PDF to be in eMediplan format. See the CH:PHARM-1 page for more information on this.</li> <li>CARA\u2019s PDF format:<ul> <li>Improved display of dosage when quantity is provided but not the when.</li> <li>Added display of active ingredients (if provided) under the medication name.</li> </ul> </li> </ul> </li> <li>Updated codes from the Swiss EPR to use the values from the 202406.2-stable release. See ITI-41 to verify some of the values.</li> <li>Added antivirus scan capabilities. PDFs attached to files uploaded to the eMedication service might now be scanned for threats before being accepted. This will work as follows depending on the different environments. For both ws-pmp-int and ws-pmp-dev, a local ClamAV service will be used for scanning. If the binary does not pass the scan or if the scan fails for whatever reason, the submission will be rejected.</li> <li>Misc. improvements, fixes and better audit log generation.</li> </ul>"},{"location":"other/upcoming_changes/#pmp-v0413","title":"PMP v0.4.13","text":"<p>Minor fixes and improved audit log generation.</p>"},{"location":"other/upcoming_changes/#pmp-v0412","title":"PMP v0.4.12","text":"<p>No relevant changes. Version deployed with a workaround for a problem with the routes of administration on PMLC generation while waiting for the next release of Husky to fix the issue. See https://github.com/project-husky/husky/issues/153</p>"},{"location":"other/upcoming_changes/#pmp-v049","title":"PMP v0.4.9","text":"<ul> <li>Fixed several bugs affecting the application of matching APPC policy sets (problems with access rights).</li> <li>All the notes received with any resource are now aggregated (e.g. a note provided with a <code>MedicationStatement</code> resource within an MTP document).</li> <li>All the aggregated comments/notes, for both medication treatment and medication treatment instance(s), will be now added to the PMLC medication statements. Previously only treatment comments were added to the PMLC.</li> <li>Fixed bug on aggregation of PADV CANCEL targeting a PRE, preventing the transaction from completing.</li> <li>Improved audit trail log generation for ITI-18 and PHARM-1 transactions (WIP for all transactions).</li> </ul>"},{"location":"other/upcoming_changes/#pmp-v048","title":"PMP v0.4.8","text":"<p>The aggregator can enable and disable the application of APPC rules (for debugging purposes) with a restart of the service, no redeployment needed.</p>"},{"location":"other/upcoming_changes/#pmp-v045","title":"PMP v0.4.5","text":"<p>The aggregator has again disabled the application of APPC rules to unblock integration tests in dev and until better debugging information is added to the affected code.</p>"},{"location":"other/upcoming_changes/#pmp-v044","title":"PMP v0.4.4","text":"<p>The aggregator has reactivated the application of APPC rules to grant or deny access rights to the PMP. An exception has been kept for TCUs to always allow TCUs right of publication:</p> <ul> <li>TCU access rules have not yet been defined by CARA.</li> <li>Some systems like Presco have yet to transition from TCU publication to HCP publication (to be done before pilot phase).</li> </ul>"},{"location":"other/upcoming_changes/#pmp-v040","title":"PMP v0.4.0","text":"<p>The PMP is abandoning the use of CARA\u2019s MPI-PID as XAD-PID and with the v0.4.0 starts a transition period towards the use of a PMP-PID (PMP assigned patient id) as XAD-PID in order to pave the road to support systems with patients from other reference communities. What this entails for PMP v0.4.0:</p> <ul> <li>Patient registration:<ul> <li>Query: an ITI-45 query (added with v0.3.0) allows a system to know if a patient has a PMP registration (whether active or not) and to fetch the PMP-PID.</li> <li>Add: to register a patient, the following steps will be needed:<ol> <li>Perform an ITI-44 Patient Registry Record Added (PIXV3 feed) to add the new patient to the PMP.</li> <li>Fetch the PMP-PID with an ITI-45 query to the PMP.</li> <li>Perform an ITI-41 with the APPC document to activate the registration. Until this is done, no other transaction for providing, fetching or searching documents will be accepted.</li> </ol> </li> </ul> </li> <li>All requests (other than PIX) expect now the use of PMP-PID ids (SubmissionSet.patientId and DocumentEntry.patientId). Systems can continue to use CARA\u2019s MPI-PIDs for this and the aggregator will perform a translation but include a warning with the response. The grace period for transitioning towards PMP-PIDs has not been defined. Note that PMP-PIDs will not be the same for the same patients in different environments, see OIDs for the each deployed platform\u2019s patient identification domain id.</li> </ul>"},{"location":"other/upcoming_changes/#pmp-v030","title":"PMP v0.3.0","text":"<p>Relevant changes from (upcoming) CH EMED EPR 1.0.0 based on CH EMED 4.0.0 (the latter should be published before the end of the current year):</p> <ul> <li>Authorship and authorship timestamps. Please refer to the CH EMED authorship guidance page for further reading:<ul> <li>All eMed entries will require the relevant authorship and authorship timestamp fields to be filled (i.e. <code>1..1</code> cardinality):<ul> <li><code>MedicationStatement</code> resources (MTP, PADV, PML, PMLC docs):<ul> <li><code>.informationSource</code> shall refer to the author of the medical decision.</li> <li><code>.dateAsserted</code> shall specify the date of said medical decision (treatment plan).</li> </ul> </li> <li>All <code>MedicationRequest</code> resources (PRE, PADV, PML docs):<ul> <li><code>.requester</code> shall refer to the author of the medical decision.</li> <li><code>.authoredOn</code> shall specify the date of said medical decision (prescription).</li> </ul> </li> <li>All <code>MedicationDispense</code> resources (DIS, PML docs):<ul> <li><code>.performer.actor</code> shall refer to the author of the medical decision (dispense).</li> <li><code>.whenHandedOver</code> shall specify the date of the dispense.</li> </ul> </li> <li>All <code>Observation</code> resources (PADV, PML docs):<ul> <li><code>.performer</code> shall refer to the author of the observation.</li> <li><code>.issued</code> shall specify the date of the observation.</li> </ul> </li> </ul> </li> <li>All <code>Composition</code> resources:<ul> <li>No changes to the composition <code>.author</code>: this shall contain the author of the document, which may match any eMed entry\u2019s author but not necessarily (e.g. an assistant adding an MTP to the PMP on behalf of a practitioner would be the composition author while the practitioner would be the entry\u2019s author).</li> <li>eMed sections of <code>Composition</code> resources will no longer support the <code>.author</code> element, which previously would optionally specify a medical author if different from the document (i.e. composition) author.</li> </ul> </li> <li>PML and PMLC eMed entries shall continue (as it is already the case) to include the <code>authorDocument</code> extension if for the last aggregated entry the document author differs from the entry\u2019s author. Note that as per the rules above, the author of the entry (i.e. medical author) is always included in the entry.</li> </ul> </li> <li>Changes to CH EMED\u2019s <code>UnitCode</code> value set:<ul> <li>Several UCUM annotations have been replaced by equivalent SNOMED codes, please refer to CH EMED <code>UnitCode</code><ul> <li><code>{Piece}</code> remains valid for now in the value set because the equivalent SNOMED term is missing, this will be solved for the next version of CH EMED when it should be replaced by a SNOMED code.</li> </ul> </li> <li>The UnitCode-based <code>CHEMEDEPRAmountQuantityUnitCode</code> value set reflects those changes.</li> </ul> </li> <li>Removed <code>N</code> from the <code>CHEMEDEprActSubstanceAdminSubstitutionCode</code> value set. This affects <code>MedicationDispense</code> resources only:<ul> <li>The value set now contains only <code>E</code> as allowed code.</li> <li>New CH EMED constraint: if no substitution has been performed, the <code>MedicationDispense.substitution.type</code> element SHALL NOT be present (see constraint <code>ch-emed-dis-1</code> on either the  CH EMED or CH EMED EPR resource definition).</li> </ul> </li> <li>Te CH EMED EPR IG reflects now that the <code>prescription</code> extension of the <code>MedicationDispense</code> resource is supported. <ul> <li>If the treatment has been prescribed, the aggregator\u2019s logic will continue to enforce that this extension is filled and that it references a valid prescription for the same treatment.</li> </ul> </li> <li>For all eMed resources, <code>note.time</code> shall not be supported any more: it is assumed that the time is the same as for the entry\u2019s authorship.<ul> <li>With the exception of the PMLC <code>CHEMEDEPRMedicationStatementCard</code> that will continue to include <code>note.time</code> for each note.</li> </ul> </li> <li><code>MedicationRequest.validityPeriod</code> is now optional, i.e. cardinality is <code>0..1</code>.<ul> <li>If not specified, start is assumed to be the <code>MedicationRequest.authoredOn</code> date.</li> <li>If not specified, end is assumed to be the end of time, i.e. the request remains valid indefinitely to the aggregator.</li> </ul> </li> </ul> <p>Other aggregator changes:</p> <ul> <li><code>FindMedicationCard</code> queries will support the <code>ServiceStartFrom</code>, <code>ServiceStartTo</code>, <code>ServiceEndFrom</code>, <code>ServiceEndTo</code> parameters and apply them as follows:<ul> <li>The consolidated (i.e. aggregated) start date of returned treatments must be between the specified <code>ServiceStartFrom</code> and <code>ServiceStartTo</code> parameters.<ul> <li>If <code>ServiceStartFrom</code> is not specified,  any treatment starting before the specified <code>ServiceStartTo</code> will meet the service start criterium.</li> <li>If <code>ServiceStartTo</code> is not specified, any treatment starting at or after the specified <code>ServiceStartFrom</code> will meet the service start criterium.</li> <li>If neither <code>ServiceStartFrom</code> nor <code>ServiceStartTo</code> are specified, all treatments starting at any date will meet the service start criterium.</li> <li>Note that if a treatment does not have an explicit start date provided by a published document, it is assumed by the aggregator to be the date of creation of the MTP.</li> </ul> </li> <li>The consolidated end date of returned treatments must be between the specified <code>ServiceEndFrom</code> and <code>ServiceEndTo</code> parameters.<ul> <li>If <code>ServiceEndFrom</code> is not specified,  any treatment ending before the specified <code>ServiceEndTo</code> will meet the service end criterium.</li> <li>If <code>ServiceEndTo</code> is not specified, any treatment ending at or after the specified <code>ServiceEndFrom</code> will meet the service end criterium.</li> <li>If neither <code>ServiceEndFrom</code> nor <code>ServiceEndTo</code> are specified, all treatments ending at any date will meet the service end criterium.</li> <li>Note that if a treatment does not have an explicit end date provided by a published document, it is assumed by the aggregator to be the end of time, i.e. will have no end date.</li> </ul> </li> </ul> </li> <li>Implementation of XDS <code>ServiceStartFrom</code>, <code>ServiceStartTo</code>, <code>ServiceEndFrom</code>, <code>ServiceEndTo</code> criteria for all ITI-18 and PHARM-1 queries.<ul> <li><code>ITI-18</code> queries will match the criteria ranges against the stored metadata <code>XDSDocumentEntry.serviceStartTime</code> and <code>XDSDocumentEntry.serviceStopTime</code> as provided at ITI-41 time. See date processing.</li> <li><code>PHARM-1</code> subqueries:<ul> <li><code>FindMedicationTreatmentPlans</code>, <code>FindMedicationList</code> and <code>FindMedicationCard</code> follow the same logic explained on the previous point.</li> <li><code>FindPrescriptions</code>, <code>FindPrescriptionsForValidation</code> and <code>FindPrescriptionsForDispense</code> will apply the criteria against the consolidated prescription\u2019s validity period. <ul> <li>The prescription validy start date shall match if:<ul> <li>Greater or equal than <code>ServiceStartFrom</code> if specified.</li> <li>Lesser than <code>ServiceStartTo</code> if specified.</li> </ul> </li> <li>The prescription validty end date shall match if:<ul> <li>Greater of equal than <code>ServiceEndFrom</code> if specified.</li> <li>Lesser than <code>ServiceEndTo</code> if specified.</li> </ul> </li> <li>If a prescription does not specify a validity period start date, it is assumed to be the date of medical authorship (i.e. <code>authoredOn</code>).</li> <li>If a prescription does not specify a validity period end date, it is assumed to not have an end date and hence any specified \u2026To parameter should match.</li> </ul> </li> <li><code>FindDispenses</code> will apply the criteria against a single date, which is the date of dispense (i.e. <code>whenHandedOver</code>).</li> </ul> </li> </ul> </li> <li>Support for a new custom parameter for <code>FindMedicationCard</code> queries, <code>$PMLCIncludeNonActive</code> has been added. If specified and <code>true</code>, it will include all the (aggregated) treatments (constrained by the specified dates criteria) for the patient, whether they are active or not (i.e. it will include also suspended or cancelled treatments). These treatments will be included as medication statements in the content of the PMLC document but will not be added to the generated PDF. Support for this parameter is already included since version (<code>2.1.2</code>) of Husky.</li> <li>Support for ITI-45 (PIXV3 queries) requests. The aggregator recognizes 3 possible data sources: CARA\u2019s MPI\u2019s assigning authority OID, the Swiss Central Compensation Office\u2019s and the PMP\u2019s own patient identity domain.</li> <li>A new PMP-PID is generated by the PMP and assigned to the patient upon registration (i.e. new APPC submission).</li> </ul>"},{"location":"transactions/","title":"Transactions","text":"<p>The eMedication service exposes its own endpoints.</p> <p>The transactions supported by these exposed endpoints can be classified as either belonging to the eMedication service content, that is, document-based (XDS or XDS-like transactions), or of a more infrastructure-like nature (e.g. PIX queries).</p>"},{"location":"transactions/#xds-and-xds-like-transactions","title":"XDS and XDS-like transactions","text":"<p>Implemented transactions:</p> <ul> <li>publish documents: XDS ITI-41, MHD ITI-65</li> <li>retrieve documents XDS ITI-43, MHD ITI-68</li> <li>update (to request deletion only) document metadata: XDS ITI-57, MHD CH:MHD-1</li> <li>search documents XDS ITI-18, MHD ITI-67</li> <li>search pharmacy documents XDS CH:PHARM-1, MHD CH:PHARM-5</li> </ul> <p>For details about documents (content and metadata), see the Documents page.</p>"},{"location":"transactions/#generic-rules-about-transactions","title":"Generic rules about transactions","text":"<ul> <li>In every transaction where a security token is required, the referenced patient has to match the same patient as the one in the XUA assertion.</li> <li>Patients are allowed to perform all types of transactions</li> <li>Healthcare Professionals are allowed to:<ul> <li>Search documents (registry stored query XDS ITI-18) and MHD/PHARM equivalents, </li> <li>Retrieve document set (XDS ITI-43) and MHD equivalent, </li> <li>Provide and register document set (XDS ITI-41) and MHD equivalent, </li> <li>Update document set (XDS ITI-57) and MHD equivalent</li> </ul> </li> <li>Healthcare Professionals cannot do anything related to APPC documents (Advanced Patient Privacy Consent).</li> <li>Technical User (TCU)  can only provide and register document set (XDS ITI-41) (and MHD equivalent).</li> <li>Anything else denied.</li> </ul> <p>Tip</p> <p>MHD transactions, as profiled by CH EPR FHIR, are provided as an early-stage-support. Bugs and profile changes/improvements are to be expected and all feedback is welcome.</p>"},{"location":"transactions/#xds-vs-mhd","title":"XDS vs. MHD","text":"<p>IHE provides different profiles, among which XDS and MHD make it possible to exchange documents:</p> <ul> <li>XDS (Cross Enterprise Document Sharing)</li> <li>MHD (Mobile access to Health Documents)</li> </ul> <p>XDS is the profile prescribed by the Swiss EPR ordinance, but MHD is simpler to implement, as it doesn\u2019t require the complex XDS stack (SOAP, WSSE, MIME-Multipart, MTOM/XOP, ebRIM, and multi-depth XML), and relies on a lighter REST interface.</p> <p>Even though the eMedication service now supports MHD transactions, it is also possible to use the MHD profile through a third party component named mobile access gateway. This component is not affiliated with this service, but referenced here for informational purposes.</p>"},{"location":"transactions/#generic-error-codes","title":"Generic error codes","text":"XDS error code Details XDSRegistryError In case of business rule error, missing/invalid XUA (authentication errors), unexpected exception. XDSUnknownPatientId If the patient ID is unknown (i.e. the patient has not registered), if the subjects is missing rights to preform the action (authorization errors)."},{"location":"transactions/#other-transactions","title":"Other transactions","text":"<p>Besides the document-based transactions, other transactions are supported as part of the eMedication service.</p> <ul> <li>ITI-20: Record Audit Event (both syslog and FHIR feed options supported)</li> <li>ITI-44: Patient Identity Feed HL7 V3 and the PIXm equivalent ITI-83</li> <li>ITI-45: PIXV3 Query and the PIXm equivalent ITI-104</li> <li> <p>CH ATC: Audit Trail Consumption</p> </li> <li> <p>ATNA logs: ITI-20, [CH:ATC][chatc.md]</p> </li> <li>PIX: PIXv3 ITI-45, PIXv3 ITI-44, PIXm ITI-83, PIXm ITI-104</li> </ul>"},{"location":"transactions/#other-links-of-interest","title":"Other links of interest","text":"<p>In addition to the XDS transactions implemented by the service, implementers may find it useful to check out the following profiles and transactions:</p> <ul> <li>Cross Enterprise User Assertion (XUA) profile, and the Provide X-User Assertion (XUA ITI-40) transaction.<ul> <li>The XUA profile defines the format of assertions inserted in transactions, that contain information about the users and their roles.</li> <li>The ITI-40 transaction is used to obtain the assertions from an assertion provider.</li> </ul> </li> <li>Healthcare Provider Directory (HPD) profile, and the Provider Information Query (HPD ITI-58) transaction.<ul> <li>The HPD profile defines the management of healthcare provider information in a directory structure.</li> <li>The ITI-58 transaction can be used to lookup healthcare provider information from a healthcare provider directory.</li> </ul> </li> <li>Audit Trail and Node Authentication (ATNA) profile, and the record audit event (ATNA ITI-20) transaction.<ul> <li>The ATNA profile might be used by implementers to record audit events through the ITI-20 transaction.</li> </ul> </li> </ul> <p>The EPD-by-example github project provides guidance and examples about these transactions and others, especially:</p> <ul> <li>Get X-User Assertion and Provide X-User Assertion</li> <li>Authenticate User</li> <li>PIX Query</li> </ul>"},{"location":"transactions/auth/","title":"Authentication and Authorization","text":""},{"location":"transactions/auth/#authentication","title":"Authentication","text":"<p>The eMedication service follows the same principle as the EPR for authentication. This means that for all patient-related transactions (XDS, MHD and ATC transactions), a Cross Enterprise User Assertion (XUA) must be provided with the request. Obtaining an XUA assertion from the EPR platform will both authenticate and authorize the claim from the EPR platform perspective. This allows the eMedication service to recognize that the client system\u2019s user is recognized by the EPR platform as being who he/she is and in the specified quality (e.g. a healthcare professional). In the rest of this page, authorization will be discussed as regarding the access rights of this EPR-authorized user to the patient\u2019s eMedication record. See the EPR by example pages for mor information on EPR authentication and authorization tokens.</p>"},{"location":"transactions/auth/#emedication-record-authorization","title":"eMedication Record Authorization","text":"<p>Access to the eMedication records is done in an all-or-nothing approach: a person is either allowed to access all the documents in a patient\u2019s eMedication record, and contribute to it - that is, to provide new documents -, or said person has no access at all.</p> <p>Patients specify the access rules to their eMedication record. These are stored by the eMedication service in an Advanced Patient Privacy Consents (APPC) document as specified by the eMedication service here. Every patient in the eMedication service has a valid registered APPC document specifying the access rules. These access rules can be modified by a patient at any time by replacing the APPC document in the eMedication service with a new version by means of an ITI-41 transaction.</p> <p>This APPC document is registered in the eMedication service as any other eMedication document, and hence can be also queried for via ITI-18 and retrieved via ITI-43 transactions. The APPC document is visible to patients only and can only be provided by patients themselves.</p>"},{"location":"transactions/auth/#rules","title":"Rules","text":"<p>The following sub-sections detail how these access rules are used by the eMedication service.</p>"},{"location":"transactions/auth/#patient","title":"Patient","text":"<p>Patients have always full access to their own eMedication record and this access cannot be affected by the rules in the APPC document.</p>"},{"location":"transactions/auth/#representatives","title":"Representatives","text":"<p>Not implemented</p> <p>This is not supported yet because CARA\u2019s platform does not expose its representative directory.</p> <p>Representatives can be granted a read-write access to all documents, through their representative identifier (which is community-specific).</p>"},{"location":"transactions/auth/#healthcare-professionals","title":"Healthcare Professionals","text":"<p>Healthcare professionals (HCPs) can be granted or denied a read-write access to all eMedication documents, through their GLN or their HPD groups. For more information on how to specify these rules, see the eMedication service APPC document page.</p>"},{"location":"transactions/auth/#hcp-assistants","title":"HCP Assistants","text":"<p>Healthcare professional assistants cannot be directly targeted by APPC access rules. Access rights of HCP assistants is determined by evaluating the assistant\u2019s responsible person\u2019s GLN and HPD groups.</p>"},{"location":"transactions/auth/#technical-users","title":"Technical Users","text":"<p>Under discussions</p> <p>The technical users access rules are still under discussion and may evolve.</p> <p>Technical users can publish documents, and may search and retrieve medication card documents if and only if the following two conditions are true:</p> <ol> <li>the TCU belongs to an organization that is whitelisted by the eMedication service.</li> <li>the patient has granted access to an organization that is part of the whitelisted organization.</li> </ol> <p>This behavior cannot be modified.</p>"},{"location":"transactions/auth/#document-administrators","title":"Document Administrators","text":"<p>Document administrators have a read-write access to all eMedication documents of all patient records. They can\u2019t read or write policy documents. This behavior cannot be modified by APPC rules.</p>"},{"location":"transactions/auth/#policy-administrators","title":"Policy Administrators","text":"<p>Policy administrators have a read-write access to all policy documents of all patient records. They can\u2019t read or write eMedication documents. This behavior cannot be modified by APPC rules.</p>"},{"location":"transactions/auth/#emergency-access","title":"Emergency Access","text":"<p>Emergency access (break-the-glass) is only possible for healthcare professionals and assistants. It can be either globally allowed or forbidden by a specific rule in the APPC document. In absence of a explicit rule in the APPC document, the eMedication service assumes emergency access to the patient\u2019s eMedication record is allowed.</p> <p>Emergency access, if enabled, allows an HCP or assistant with an emergency-access-authorized XUA token by the EPR platform access to the patient\u2019s eMedication record even if the HCP would not be normally authorized by application of the policies contained in the patient\u2019s APPC document.</p>"},{"location":"transactions/auth/#atna","title":"ATNA","text":"<p>The eMedication service generates audit event logs for all its internal activity as well as all the transactions with the client systems, as specified by the Audit Trail and Node Authentication (ATNA) profile and as per the Swiss EPR regulations, and stored in its own Audit Record Repository. Additionally, all audit events that are related to a patient - and, therefore, all the transaction-related events - generated by the eMedication service are compliant with the CH ATC profile, as required by the EPR regulations. These patient audit events can be retrieved by client systems by means of a CH ATC transaction, supported by the eMedication service.</p> <p>All client systems are also obliged to generate audit events for all the transactions with the eMedication service and send them to the eMedication service Audit Record Repository by means of a Record Audit Event (ITI-20) transaction. All patient-related events should be CH ATC compliant.</p>"},{"location":"transactions/auth/#enrollment-and-opt-out","title":"Enrollment and Opt-out","text":""},{"location":"transactions/auth/#enrollment-requirements","title":"Enrollment Requirements","text":"<p>In order to be enrolled, a patient must fulfill the following requirements:</p> <ul> <li>The patient must have an active EPR and the system enrolling the patient must know the associated EPR-SPID.</li> <li>The system must be in a position to immediately provide a valid APPC document for the enrolling patient.</li> </ul>"},{"location":"transactions/auth/#enrollment-process","title":"Enrollment Process","text":"<p>In order to register a patient in the eMedication service, a client system must perform the following steps:</p> <ol> <li>Perform a PIX feed to register the patient id in the eMedication service.</li> <li>Provide the APPC document for the patient.</li> </ol> <p>Warning</p> <p>Systems must absolutely ensure they can provide the APPC document immediately after completing the ITI-44 transaction. Failure to do so will create a dangling registration in which the eMedication service will have a registered PMP-PID for the patient but it will not recognize its registration (ITI-45 will not recognize the patient ids) until an APPC document is provided. No other transactions than an ITI-41 to provide the APPC document will be allowed in the meantime.</p> <p>Warning</p> <p>These rules are currently under revision by CARA, particularly regarding the patient\u2019s formal consent to use the eMedication service, and might change before, during or after completion of the pilot program of the eMedication service.</p>"},{"location":"transactions/auth/#opt-out","title":"Opt-out","text":"<p>Patients can opt out of the eMedication service at any time. This is simply done by deleting their current APPC document via an ITI-57 transaction. Completion of this transaction will permanently delete the enterity of the patient\u2019s eMedication record. </p> <p>Warning</p> <p>The removal of the patient\u2019s eMedication record is irreversible. After deletion of the record, the patient will be allowed to open an eMedication record again at any time, but the contents of the previous eMedication record cannot and will not be restored.</p>"},{"location":"transactions/chatc/","title":"Audit Trail Consumption [CH ATC]","text":"<p>The eMedication service supports the retrieval of patient audit trail events, in FHIR format as specified by the implementation guide, and in compliance with the Supplement 2.2 to the Annex 5 of the EPR Act and itself based on IHE\u2019s Retrieve ATNA Audit Event [ITI-81] transaction as specified by the Add RESTful ATNA (Query and Feed) supplement to IHE IT Infrastructure Technical Framework.</p> <p>This transaction is implemented by the eMedication service as specified by the resources linked in the previous paragraph with the following particularities:</p> <ul> <li>All the query parameters defined by the IHE supplement are supported, but with the following limitations:<ul> <li><code>address</code> testing does not take into account modifiers, only case sensitive exact matches.</li> <li><code>agent.identifier</code> testing does not take into account modifiers and is always case sensitive.</li> <li><code>patient.identifier</code> testing is done without taking into account modifiers and it is always case sensitive. Matching does not additionally filter by type: it is assumed that if the identifier matches, that is good enough.</li> <li><code>entity.identifier</code> testing is done without taking modifiers into account and it is always case sensitive. <code>OR</code> criteria for this parameter is not supported.</li> <li><code>entity.type</code> testing is done without taking modifiers inot account and it is always case sensitive.</li> <li><code>entity.role</code> testing is done without taking modifiers into account and it is always case sensitive.</li> <li><code>source.identifier</code> testing is done without taking modifiers into account and it is always case sensitive. <code>OR</code> criteria for this parameter is not supported.</li> <li><code>type</code> testing is done without taking modifiers into account and it is always case sensitive.</li> <li><code>subtype</code> testing is done without taking modifiers into account and it is always case sensitive.</li> <li><code>outcome</code> testing is done without taking modifiers into account and it is always case sensitive.</li> <li>The FHIR standard parameters that apply to all resources (<code>_content</code>, <code>_id</code>, <code>_lastUpdated</code>) are not supported.</li> <li>FHIR search parameters are not supported.</li> </ul> </li> </ul>"},{"location":"transactions/chatc/#security-considerations","title":"Security Considerations","text":"<p>Note that beside the security considerations expressed (directly or indirectly) by the CH EPR FHIR profile, the eMedication service implementation supports only, for now, the SAML Token option, which means that the authorization token conveyed with the HTTP request must be an XUA token.</p>"},{"location":"transactions/chmhd1/","title":"CH:MHD-1","text":"<p>The CH:MHD-1 (Update Document Metadata) transaction allows a Document Source actor (e.g. a primary system) to update document metadata on the Document Recipient (i.e. the eMedication service). What this means in practice, for the eMedication service, is that, as for the ITI-57 transaction this is an MHD-like alternative to, a Document Source is allowed to flag a document as to be deleted by the eMedication service. The same kind of business logic and constraints apply as for the XDS counterpart.</p> <p>Because of this, the only attribute that it is allowed to be modified from the original document metadata (<code>DocumentReference</code>), is the <code>deletionStatus</code> extension of the document reference. Not only this is the only allowed change, but because of this, it is mandatory to be set as <code>urn:e-health-suisse:2019:deletionStatus:deletionRequested</code>.</p>"},{"location":"transactions/chmhd1/#processing-of-deletion-requests","title":"Processing of Deletion Requests","text":"<p>For now, the eMedication service processes deletion requests immediately. This means that a document for which the metadata update is accepted, will be immediately deleted and hence neither the document nor its metadata will be available any more.</p>"},{"location":"transactions/chmhd1/#security-considerations","title":"Security Considerations","text":"<p>Note that beside the security considerations expressed (directly or indirectly) by the CH EPR FHIR profile, the eMedication service implementation supports only, for now, the SAML Token option, which means that the authorization token conveyed with the HTTP request must be an XUA token.</p>"},{"location":"transactions/chpharm1/","title":"CH:PHARM-1: Query Pharmacy Documents","text":"<p>CH:PHARM-1 (Query Pharmacy Documents) is an extension of PHARM-1, a transaction defined by IHE Pharmacy in the CMPD profile.</p> <p>The eMedication service doesn\u2019t support CMA (Community Medication Administration) documents and these won\u2019t be present in any response.</p>"},{"location":"transactions/chpharm1/#stored-queries","title":"Stored queries","text":"<p>In relation to IHE\u2019s PHARM-1, CH:PHARM-1 defines three additional queries: <code>FindMedicationCard</code>, <code>FindPrescriptionsForValidation</code> and <code>FindPrescriptionsForDispense</code>.</p>"},{"location":"transactions/chpharm1/#common-query-parameters","title":"Common query parameters","text":"<p>The following parameters are supported by all the PHARM-1 (and CH:PHARM-1) queries received by the eMedication service:</p> <ul> <li><code>$XDSDocumentEntryPatientId</code> (required): the patient\u2019s PMP-PID.</li> <li><code>$XDSDocumentEntryService(Start|Stop)Time(From|To)</code>: the behaviour of these parameters for the PHARM-1 queries implemention of the eMedication service does not match the behaviour of the ITI-18 queries. Instead of matching the parameters against the <code>DocumentEntry</code> metadata in the registry, PHARM-1 queries will test the parameters against consolidated treatment data, see each transaction\u2019s own section in this page to know exactly how these parameters are interpreted in such cases.</li> <li><code>$XDSDocumentEntryStatus</code> (required).</li> </ul>"},{"location":"transactions/chpharm1/#find-stable-documents","title":"Find Stable Documents","text":"<p>A subset of the supported PHARM-1 queries allow to recover stable documents. These have the following parameters in common:</p> <ul> <li><code>$XDSDocumentEntryPracticeSettingCode</code>: See the Annex 3 of the EPR Act, section 2.4, for possible values.</li> <li><code>$XDSDocumentEntryHealthcareFacilityTypeCode</code>: See the Annex 3 of the EPR Act, section 2.3, for possible values.</li> <li><code>$XDSDocumentEntryEventCodeList</code>: See the Annex 3 of the EPR Act, section 2.8, for possible values.</li> <li><code>$XDSDocumentEntryConfidentialityCode</code>: All documents in the eMedication service are set to <code>Normal</code>. See the Annex 3 of the EPR Act, section 2.8</li> <li><code>$XDSDocumentEntryUniqueId</code>.</li> <li><code>$XDSDocumentEntryEntryUUID</code>.</li> <li><code>$XDSCreationTime(From|To)</code>: see date processing. These are matched agains the available <code>DocumentEntry</code> metadata in the registry.</li> <li><code>$XDSAuthorPerson</code>.</li> </ul> <p>Either <code>$XDSDocumentEntryEntryUUID</code> or <code>$XDSDocumentEntryUniqueId</code> shall be specified.</p>"},{"location":"transactions/chpharm1/#findmedicationtreatmentplans","title":"FindMedicationTreatmentPlans","text":"<p>Implemented, as per IHE specs.</p> <p>The <code>$XDSDocumentEntryService(Start|Stop)Time(From|To)</code> parameters, if present, will be matched against the treatments\u2019 consolidated start and end times:</p> <ul> <li>The consolidated start date of returned treatments must be between the specified <code>$XDSDocumentEntryServiceStartFrom</code> and <code>$XDSDocumentEntryServiceStarTo</code> parameters:<ul> <li>If <code>$XDSDocumentEntryServiceStartFrom</code> is not specified, any treatment starting before the specified <code>$XDSDocumentEntryServiceStarTo</code> will meet the service start criterium.</li> <li>If <code>$XDSDocumentEntryServiceStartTo</code> is not specified, any treatment starting at or after the specified <code>$XDSDocumentEntryServiceStartFrom</code> will meet the service start criterium.</li> <li>If neither <code>$XDSDocumentEntryServiceStartFrom</code> nor <code>$XDSDocumentEntryServiceStartTo</code> are specified, all treatments starting at any date will meet the service start criterium.</li> <li>Note that if a treatment does not have an explicit start dat eprovided by a published document, it is assumed to be the date of creation fo the MTP document.</li> </ul> </li> <li>The consolidated end date of returned treatments must be between the specified <code>$XDSDocumentEntryServiceEndFrom</code> and <code>$XDSDocumentEntryServiceEndTo</code> parameters.<ul> <li>If <code>$XDSDocumentEntryServiceEndFrom</code> is not specified, any treatment ending before the specified <code>$XDSDocumentEntryServiceEndTo</code> will meet the service end criterium.</li> <li>If <code>$XDSDocumentEntryServiceEndTo</code> is not specified, any treatment ending at or after the specified <code>$XDSDocumentEntryServiceEndTo</code> will meet the service end criterium.</li> <li>If neither <code>$XDSDocumentEntryServiceEndFrom</code> nor <code>$XDSDocumentEntryServiceEndTo</code> are specified, all treatments ending at any date will meet the service end criterium.</li> <li>Note that if a treatment does not have an explicit end date provided by a published document, it is assumed by the aggregator to be the end of time, i.e. it will have no end date.</li> </ul> </li> </ul>"},{"location":"transactions/chpharm1/#findprescriptions","title":"FindPrescriptions","text":"<p>Implemented, as per IHE specs. </p> <p>The <code>$XDSDocumentEntryService(Start|Stop)Time(From|To)</code> parameters, if present, will be matched against the prescriptions\u2019 consolidated validity period:</p> <ul> <li>The prescription validity start date shall match if:<ul> <li>Greater or equal than <code>ServiceStartFrom</code> if specified.</li> <li>Lesser than <code>ServiceStartTo</code> if specified.</li> </ul> </li> <li>The prescription validity end date shall match if:<ul> <li>Greater or equal than <code>ServiceEndFrom</code> if specified.</li> <li>Lesser than <code>ServiceEndTo</code> if specified.</li> </ul> </li> <li>If a prescription does not specify a validity period start date, if is assumed to be the date of medical authorship (i.e. the <code>authoredOn</code> field within the CH EMED EPR content).</li> <li>If a prescription does not specify a validity period end date, it is assumed to not have an end date and hence any specified <code>...To</code> parameter should match.</li> </ul>"},{"location":"transactions/chpharm1/#finddispenses","title":"FindDispenses","text":"<p>Implemented, as per IHE specs.</p> <p>The <code>$XDSDocumentEntryService(Start|Stop)Time(From|To)</code> parameters, if present, will be all matched against the date of dispense, that is, the <code>whenHandedOver</code> field of the CH EMED EPR content.</p>"},{"location":"transactions/chpharm1/#findmedicationadministrations","title":"FindMedicationAdministrations","text":"<p>\ud83d\udeab Not supported.</p>"},{"location":"transactions/chpharm1/#findprescriptionsforvalidation","title":"FindPrescriptionsForValidation","text":"<p>Implemented, as per IHE specs.</p> <p>The <code>$XDSDocumentEntryService(Start|Stop)Time(From|To)</code> parameters, if present, will be matched against the prescriptions\u2019 consolidated validity period:</p> <ul> <li>The prescription validity start date shall match if:<ul> <li>Greater or equal than <code>ServiceStartFrom</code> if specified.</li> <li>Lesser than <code>ServiceStartTo</code> if specified.</li> </ul> </li> <li>The prescription validity end date shall match if:<ul> <li>Greater or equal than <code>ServiceEndFrom</code> if specified.</li> <li>Lesser than <code>ServiceEndTo</code> if specified.</li> </ul> </li> <li>If a prescription does not specify a validity period start date, if is assumed to be the date of medical authorship (i.e. the <code>authoredOn</code> field within the CH EMED EPR content).</li> <li>If a prescription does not specify a validity period end date, it is assumed to not have an end date and hence any specified <code>...To</code> parameter should match.</li> </ul>"},{"location":"transactions/chpharm1/#findprescriptionsfordispense","title":"FindPrescriptionsForDispense","text":"<p>Implemented, as per IHE specs. Return only prescriptions that are actually provisional or active (i.e. dispensable).</p> <p>The <code>$XDSDocumentEntryService(Start|Stop)Time(From|To)</code> parameters, if present, will be matched against the prescriptions\u2019 consolidated validity period:</p> <ul> <li>The prescription validity start date shall match if:<ul> <li>Greater or equal than <code>ServiceStartFrom</code> if specified.</li> <li>Lesser than <code>ServiceStartTo</code> if specified.</li> </ul> </li> <li>The prescription validity end date shall match if:<ul> <li>Greater or equal than <code>ServiceEndFrom</code> if specified.</li> <li>Lesser than <code>ServiceEndTo</code> if specified.</li> </ul> </li> <li>If a prescription does not specify a validity period start date, if is assumed to be the date of medical authorship (i.e. the <code>authoredOn</code> field within the CH EMED EPR content).</li> <li>If a prescription does not specify a validity period end date, it is assumed to not have an end date and hence any specified <code>...To</code> parameter should match.</li> </ul>"},{"location":"transactions/chpharm1/#findmedicationlist","title":"FindMedicationList","text":"<p>Implemented, as per IHE specs.</p> <p>Entry selection (via the search query execution) is done at document retrieval time, not search time.</p> <p>On top of the common PHARM-1 parameters, the following parameters are supported:</p> <ul> <li><code>$XDSDocumentEntryType</code> (required): If empty, <code>Stable</code> will be assumed.</li> <li><code>$XDSDocumentEntryFormatCode</code>: See the ITI-41 section in this guide.</li> </ul> <p>The <code>$XDSDocumentEntryService(Start|Stop)Time(From|To)</code> parameters, if present, will be matched against the treatments\u2019 consolidated start and end times:</p> <ul> <li>The consolidated start date of returned treatments must be between the specified <code>$XDSDocumentEntryServiceStartFrom</code> and <code>$XDSDocumentEntryServiceStarTo</code> parameters:<ul> <li>If <code>$XDSDocumentEntryServiceStartFrom</code> is not specified, any treatment starting before the specified <code>$XDSDocumentEntryServiceStarTo</code> will meet the service start criterium.</li> <li>If <code>$XDSDocumentEntryServiceStartTo</code> is not specified, any treatment starting at or after the specified <code>$XDSDocumentEntryServiceStartFrom</code> will meet the service start criterium.</li> <li>If neither <code>$XDSDocumentEntryServiceStartFrom</code> nor <code>$XDSDocumentEntryServiceStartTo</code> are specified, all treatments starting at any date will meet the service start criterium.</li> <li>Note that if a treatment does not have an explicit start dat eprovided by a published document, it is assumed to be the date of creation fo the MTP document.</li> </ul> </li> <li>The consolidated end date of returned treatments must be between the specified <code>$XDSDocumentEntryServiceEndFrom</code> and <code>$XDSDocumentEntryServiceEndTo</code> parameters.<ul> <li>If <code>$XDSDocumentEntryServiceEndFrom</code> is not specified, any treatment ending before the specified <code>$XDSDocumentEntryServiceEndTo</code> will meet the service end criterium.</li> <li>If <code>$XDSDocumentEntryServiceEndTo</code> is not specified, any treatment ending at or after the specified <code>$XDSDocumentEntryServiceEndTo</code> will meet the service end criterium.</li> <li>If neither <code>$XDSDocumentEntryServiceEndFrom</code> nor <code>$XDSDocumentEntryServiceEndTo</code> are specified, all treatments ending at any date will meet the service end criterium.</li> <li>Note that if a treatment does not have an explicit end date provided by a published document, it is assumed by the aggregator to be the end of time, i.e. it will have no end date.</li> </ul> </li> </ul>"},{"location":"transactions/chpharm1/#findmedicationcard","title":"FindMedicationCard (\ud83c\udde8\ud83c\udded)","text":"<p>This transaction is a Swiss extension. </p> <p>Stored query ID: <code>urn:uuid:a8fc04c1-5fb0-45a9-bc59-7a59958beb38</code></p> <p>Treatment selection (via the search query execution) is done at document retrieval time, not search time.</p> <p>Query parameters</p> <p>On top of the common PHARM-1 parameters, the following parameters are supported:</p> <ul> <li><code>$XDSDocumentEntryType</code> (required): should be <code>On-demand</code>. A query for <code>Stable</code> documents only will yield an empty result set.</li> <li><code>$XDSDocumentEntryFormatCode</code>: this parameter is used to specify whether the query should return only a PDF (<code>urn:che:epr:EPR_Unstructured_Document</code>) or a PMLC document as specified in CH EMED EPR (<code>urn:che:epr:ch-emed:medication-card:2023</code>), containing the PDF as well as original representation of the FHIR document. If not specified, PMLC document is assumed.</li> <li><code>$XDSDocumentEntryLanguageCode</code>: the language that will be used to generate the medication card. If not specified, the eMedication service uses the default language (French). At present, the eMedicationService supports only French language (<code>fr-CH</code>).</li> <li><code>$PMLCIncludeNonActive</code>: either <code>true</code> or <code>false</code>. If ommitted, <code>false</code> will be assumed. When <code>false</code>, the query will return only active treatments (plus the last treatment to be added or modified to the patient\u2019s eMedication even if it is no-longer active). When true, all treatments matching the query\u2019s criteria will be returned, whether active or not at the moment.</li> <li><code>$PMLCPaperFormat</code>: all values from the CHEMEDEPRPaperFormatCS are supported. This parameter, by default <code>cara-pmp</code> allows a client to request that PMLC PDF be generated following a specific format. For now only CARA\u2019s own format and eMediplan format are supported.</li> </ul> <p>The <code>$XDSDocumentEntryService(Start|Stop)Time(From|To)</code> parameters, if present, will be matched against the treatments\u2019 consolidated start and end times:</p> <ul> <li>The consolidated start date of returned treatments must be between the specified <code>$XDSDocumentEntryServiceStartFrom</code> and <code>$XDSDocumentEntryServiceStarTo</code> parameters:<ul> <li>If <code>$XDSDocumentEntryServiceStartFrom</code> is not specified, any treatment starting before the specified <code>$XDSDocumentEntryServiceStarTo</code> will meet the service start criterium.</li> <li>If <code>$XDSDocumentEntryServiceStartTo</code> is not specified, any treatment starting at or after the specified <code>$XDSDocumentEntryServiceStartFrom</code> will meet the service start criterium.</li> <li>If neither <code>$XDSDocumentEntryServiceStartFrom</code> nor <code>$XDSDocumentEntryServiceStartTo</code> are specified, all treatments starting at any date will meet the service start criterium.</li> <li>Note that if a treatment does not have an explicit start dat eprovided by a published document, it is assumed to be the date of creation fo the MTP document.</li> </ul> </li> <li>The consolidated end date of returned treatments must be between the specified <code>$XDSDocumentEntryServiceEndFrom</code> and <code>$XDSDocumentEntryServiceEndTo</code> parameters.<ul> <li>If <code>$XDSDocumentEntryServiceEndFrom</code> is not specified, any treatment ending before the specified <code>$XDSDocumentEntryServiceEndTo</code> will meet the service end criterium.</li> <li>If <code>$XDSDocumentEntryServiceEndTo</code> is not specified, any treatment ending at or after the specified <code>$XDSDocumentEntryServiceEndTo</code> will meet the service end criterium.</li> <li>If neither <code>$XDSDocumentEntryServiceEndFrom</code> nor <code>$XDSDocumentEntryServiceEndTo</code> are specified, all treatments ending at any date will meet the service end criterium.</li> <li>Note that if a treatment does not have an explicit end date provided by a published document, it is assumed by the aggregator to be the end of time, i.e. it will have no end date.</li> </ul> </li> </ul>"},{"location":"transactions/chpharm5/","title":"CH:PHARM-5","text":"<p>This transaction is the RESTful alternative to the CH:PHARM-1 transaction, as defined by the defined by IHE Pharmacy in the CMPD profile but with some Swiss extensions. The same business logic and constraints as for CH:PHARM-1 applies.</p> <p>As for the ITI-67 request, the eMedication service backend is grouped with the XDS on FHIR option, and hence the <code>identifier</code> query parameter is not supported. All other parameters specified by PHARM-5 are supported.</p>"},{"location":"transactions/chpharm5/#endpoints","title":"Endpoints","text":"<p>Each CH:PHARM-1 stored query becomes a FHIR operation in CH:PHARM-5. This means that, unlike its XDS-like counterpart, CH:PHARM-5 has a distinct endpoint per defined operation. These are the names of the operations: - $find-medication-treatment-plans - $find-prescritions - $find-dispenses - $find-prescriptions-for-validation - $find-prescriptions-for-dispense - $find-medication-list - $find-medication-card</p> <p>In practice, this means that if the base URL for FHIR <code>DocumentReference</code> resources is <code>https://example.com/pmp/fhir/DocumentReference</code>, then the endpoint for a CH:PHARM-5 FindMedicationCard request would be <code>https://example.com/pmp/fhir/DocumentReference/$find-medication-card</code>.</p>"},{"location":"transactions/chpharm5/#security-considerations","title":"Security Considerations","text":"<p>Note that beside the security considerations expressed (directly or indirectly) by parent profiles, the eMedication service implementation supports only, for now, the SAML Token option, which means that the authorization token conveyed with the HTTP request must be an XUA token.</p>"},{"location":"transactions/date_processing/","title":"Processing of dates","text":""},{"location":"transactions/date_processing/#xds","title":"XDS","text":"<p>HL7\u2019s DTM shall be encoded in the format <code>YYYY[MM[DD[HH[MM[SS[.S[S[S[S]]]]]]]]][+/-ZZZZ]</code>. It allows various precision levels and the choice of time zone.</p> <p>DocumentEntries fields creationTime, serviceStartTime and serviceStopTime shall be specified in UTC (DTM\u2019s time zone part is forbidden).</p> <p>ITI-18 query parameters can be expressed in any time zone.</p> <p>Parameters $XDSDocumentEntry(Creation|ServiceStart|ServiceStop)TimeFrom are inclusive, parameters $XDSDocumentEntry(Creation|ServiceStart|ServiceStop)TimeTo are exclusive.</p> <p>When encountering an incomplete (i.e. a date that is not precise to the second) date, the date is set to the earliest instant covered by the partial date.</p> <p>The PMP recommends to: 1. always give dates in UTC; 2. always give dates if possible at least at the second precision.</p>"},{"location":"transactions/date_processing/#fhir","title":"FHIR","text":"<p>In FHIR, periods are given with inclusive boundaries.</p> <p>The dateTime format is different: YYYY, YYYY-MM, YYYY-MM-DD, YYYY-MM-DDThh:mm:ss+zz:zz or YYYY-MM-DDThh:mm:ss.sssZ. When using the time precision, the timezone is mandatory.</p>"},{"location":"transactions/documents/","title":"Documents","text":""},{"location":"transactions/documents/#content","title":"Content","text":"<p>The eMedication service only support PMP-APPC and CH EMED EPR documents.</p>"},{"location":"transactions/documents/#metadata","title":"Metadata","text":"<p>When two cardinalities are given, the first one is for Content Sender actor and the second one for the Document Repository actor.</p> DocumentEntry Cardinality Comment <code>author</code> 0..* It\u2019s 1..* for eMed documents <code>author.authorInstitution</code> M <code>author.authorPerson</code> 1 <code>author.authorRole</code> 1 <code>author.authorSpecialty</code> 0..? <code>author.authorTelecommunication</code> M <code>availabilityStatus</code> 0..1 / 1 Only \u201cApproved\u201d for Content Senders <code>classCode</code> 1 <code>comments</code> 0..1 <code>confidentialityCode</code> 1 Only \u201cNormal\u201d <code>creationTime</code> 1 <code>deletionStatus</code> 0..1 / 1 Only \u201cdeletion not requested\u201d for Content Senders <code>documentAvailability</code> 0..1 / 1 Only \u201cOnline\u201d <code>entryUUID</code> 1 Random value <code>eventCodeList</code> 0..* <code>formatCode</code> 1 <code>hash</code> 0..1 / 1 <code>healthcareFacilityTypeCode</code> 1 <code>homeCommunityId</code> 0..1 / 1 <code>languageCode</code> 1 <code>legalAuthenticator</code> 0..1 <code>limitedMetadata</code> 0 <code>logicalID</code> 0..1 / 1 Same value as the <code>entryUUID</code> <code>mimeType</code> 1 Single value <code>objectType</code> 1 Only \u201cstable\u201d for Content Senders <code>originalProviderRole</code> 1 <code>patientId</code> 1 The XAD-PID <code>practiceSettingCode</code> 1 <code>referenceIdList</code> 0..* / 0 Ignored by the eMedication service <code>repositoryUniqueId</code> 0..1 / 1 Use the eMedication service document repository OID for the relevant environment <code>serviceStartTime</code> 0..1 <code>serviceStopTime</code> 0..1 <code>size</code> 0..1 / 1 <code>sourcePatientId</code> 1 <code>sourcePatientInfo</code> 0..1 / 0 Ignored by the eMedication service <code>title</code> 1 <code>typeCode</code> 1 <code>uniqueId</code> 1 <code>URI</code> 0 / 1 It contains the MHD download link <code>version</code> 0..1 / 1 Only \u201c1\u201d <p>Mapping per document type are given in the ITI-41 page.</p> <p>Value sets:</p> <ol> <li>author.authorRole</li> <li>author.authorSpecialty</li> <li>deletionStatus</li> <li>eventCodeList</li> <li>healthcareFacilityTypeCode</li> <li>languageCode</li> <li>originalProviderRole</li> <li>practiceSettingCode</li> </ol>"},{"location":"transactions/iti104/","title":"ITI-104","text":"<p>The ITI-104 (Patient Identity Feed) transaction allows a Patient Identity Source actor (e.g. a primary system) to add patient data to the eMedication service. This provides a RESTful equivalent to the ITI-44 transaction and hence the same business logic and restrictions as for the PIXv3 transaction apply.</p>"},{"location":"transactions/iti104/#allowed-operations","title":"Allowed Operations","text":"<p>The eMedication service allows only an <code>Add or revise Patient</code> message and, in any case, it will just create (if needed) the patient registration in the eMedication service and prior forwarding an ITI-44 request to CARA\u2019s MPI if no patient record is present there. As such, the eMedication service itself neither performs any data reconciliation nor acts as a pure proxy to the PIX service of the community. The sole purpose of this transaction is to allow a primary system to register a patient on the eMedication service, please read the details on the ITI-44 page of this service guide.</p>"},{"location":"transactions/iti104/#request-message","title":"Request Message","text":""},{"location":"transactions/iti104/#identifiers","title":"Identifiers","text":"<p>All identifiers are conveyed within the <code>Patient.identifier</code> element of the request\u2019s payload. Because the request is translated to an ITI-44 request internally, certain expectations apply to its content:</p> <ul> <li>One and only one EPR-SPID identifier is expected.</li> <li>Either one local PID or an MPID for the patient are expected to be present. At least one of them and, optionally, both, and one must match the <code>identifier</code> query parameter.</li> <li>Only the following non-local PIDs that are recognizable by the eMedication service as such are allowed to be conveyed, as profiled by CHPIXmPatientFeed:<ul> <li>Insurance card number (VEKA)</li> <li>AVS number</li> </ul> </li> </ul>"},{"location":"transactions/iti104/#response-message","title":"Response Message","text":"<p>Because the eMedication service does not support transactions that return a <code>Patient</code> resource, and because no data reconciliation is done, it was decided that in order to avoid misunderstandings or false assumptions, the eMedication service shall never return a <code>Patient</code> resource as a response. Hence, depending on the expressed preferences in the HTTP request, either an <code>OperationOutcome</code> or simply an HTTP code will be returned in case of success, and only an <code>OperationOutcome</code> in case of failure.</p>"},{"location":"transactions/iti18/","title":"ITI-18","text":"<p>The ITI-18 (Registry Stored Query) transaction allows a Document Consumer to query a Document Registry, using Registry Stored Queries.</p> <p>This transaction has been implemented in order to respect the Swiss EPR regulation. However, it is very generic, and CH:PHARM-1 should be favored, as it offers emedication-specific query parameters.</p> <p>See also EPD by example\u2019s Registry Stored Query page.</p>"},{"location":"transactions/iti18/#stored-queries","title":"Stored queries","text":""},{"location":"transactions/iti18/#generic-rules","title":"Generic rules","text":"<ul> <li>The folders option is not supported as per the Swiss National Extensions to the IHE Technical Framework.</li> <li>The only association supported is RPLC (replace).</li> <li>Documents with <code>deletionStatus=deletionRequested</code> are ignored.</li> <li>Objects belonging to a patient other than the patient of the provided XUA token are ignored, as per the Swiss National Extensions to the IHE Technical Framework.</li> <li>All the queries support the XDS Metadata Update supplement.</li> </ul>"},{"location":"transactions/iti18/#common-query-parameters","title":"Common query parameters","text":"<ul> <li><code>$MetadataLevel</code>: If present, the attribute shall be equal to <code>1</code>, as per the Swiss National Extensions to the IHE Technical Framework.</li> </ul>"},{"location":"transactions/iti18/#finddocuments","title":"FindDocuments","text":"<p>This stored query allows to search for APPC and CH EMED EPR documents. CH EMED EPR documents could also be searched through the PHARM-1 transaction (it\u2019s a specialized ITI-18 transaction). The parameters are matched against the corresponding <code>XDSDocumentEntry</code> metadata attributes of the documents in the registry.</p> <p>All the parameters defined in the IHE profile are supported:</p> Parameter Name Required Remarks <code>$XDSDocumentEntryPatientId</code> yes The patient\u2019s PMP-PID <code>$XDSDocumentEntryClassCode</code> no See the Annex 3 of the EPR Act, section 2.5, for possible values <code>$XDSDocumentEntryTypeCode</code> no See the Annex 3 of the EPR Act, section 2.6, for possible values <code>$XDSDocumentEntryPracticeSettingCode</code> no See the Annex 3 of the EPR Act, section 2.4, for possible values <code>$XDSDocumentEntryCreationTimeFrom</code> no see dates processing <code>$XDSDocumentEntryCreationTimeTo</code> no see dates processing <code>$XDSDocumentEntryServiceStartTimeFrom</code> no Ignored for APPC documents. see dates processing <code>$XDSDocumentEntryServiceStartTimeTo</code> no Ignored for APPC documents. see dates processing <code>$XDSDocumentEntryServiceStopTimeFrom</code> no Ignored for APPC documents. see dates processing <code>$XDSDocumentEntryServiceStopTimeTo</code> no Ignored for APPC documents. see dates processing <code>$XDSDocumentEntryHealthcareFacilityTypeCode</code> no See the Annex 3 of the EPR Act, section 2.3, for possible values <code>$XDSDocumentEntryEventCodeList</code> no See the Annex 3 of the EPR Act, section 2.8, for possible values <code>$XDSDocumentEntryConfidentialityCode</code> no All documents in the eMedication service are set to <code>Normal</code>. See the Annex 3 of the EPR Act, section 2.8 <code>$XDSDocumentEntryAuthorPerson</code> no - <code>$XDSDocumentEntryFormatCode</code> no See the ITI-41 section in this guide <code>$XDSDocumentEntryStatus</code> yes - <code>$XDSDocumentEntryType</code> no If empty, <code>Stable</code> will be assumed <code>$XDSDocumentEntryDocumentAvailability</code> no All documents in the eMedication service are set to <code>Online</code>"},{"location":"transactions/iti18/#findsubmissionsets","title":"FindSubmissionSets","text":"<p>This stored query allows to search for submission sets in the eMedication service registry. Query parameters are matched against the corresponding submission set metadata attributes in the registry. All the parameters defined in the IHE profile are supported.</p> Parameter Name Required Remarks <code>$XDSSubmissionSetPatientId</code> yes \u00a0The patient\u2019s PMP-PID <code>$XDSSubmissionSetSourceId</code> no - <code>$XDSSubmissionSetSubmissionTimeFrom</code> no see dates processing <code>$XDSSubmissionSetSubmissionTimeTo</code> no see dates processing <code>$XDSSubmissionSetAuthorPerson</code> no - <code>$XDSSubmissionSetContentType</code> no All submission sets in the eMedication service are of <code>Procedure</code> content type. See the Annex 3 of the EPR Act, section 2.15 <code>$XDSSubmissionSetStatus</code> yes All submission sets in the eMedication service are <code>Approved</code>"},{"location":"transactions/iti18/#findfolders","title":"FindFolders","text":"<p>This query is not supported by the eMedication service.</p>"},{"location":"transactions/iti18/#getall","title":"GetAll","text":"<p>This stored query allows search for all registry content for a given patient and returns:</p> <ul> <li><code>XDSSubmissionSet</code> and <code>XDSDocumentEntry</code> objects matching the query parameters.</li> <li><code>Association</code> objects with <code>sourceObject</code> or <code>targetObject</code> attribute matching one of the above objects.</li> </ul> <p>All the parameters defined in the IHE profile are supported.</p> Parameter Name Required Remarks <code>$patientId</code> yes The patient\u2019s PMP-PID <code>$XDSDocumentEntryStatus</code> yes - <code>$XDSSubmissionSetStatus</code> yes All submission sets in the eMedication service are <code>Approved</code> <code>$XDSFolderStatus</code> yes Ignored by the eMedication service <code>$XDSDocumentEntryFormatCode</code> no See the ITI-41 section in this guide <code>$XDSDocumentEntryConfidentialityCode</code> no All documents in the eMedication service are set to <code>Normal</code>. See the Annex 3 of the EPR Act, section 2.8 <code>$XDSDocumentEntryType</code> no If empty, <code>Stable</code> will be assumed <code>$XDSAssociationStatus</code> no Associations in the eMedication service can only be <code>Approved</code>. If empty, <code>Approved</code> will be assumed"},{"location":"transactions/iti18/#getdocuments","title":"GetDocuments","text":"<p>This stored query allows to fetch a collection of <code>XDSDocumentEntry</code> objects. All the IHE profile parameters are supported.</p> Parameter Name Required Remarks <code>$XDSDocumentEntryEntryUUID</code> no<sup>*</sup> - <code>$XDSDocumentEntryUniqueId</code> no<sup>*</sup> - <code>$XDSDocumentEntryLogicalID</code> no<sup>*</sup> - <code>$homeCommunityId</code> no - <p><sup>*</sup> Either <code>$XDSDocumentEntryEntryUUID</code>, <code>$XDSDocumentEntryUniqueId</code> or <code>$XDSDocumentEntryLogicalID</code> shall be specified. This transaction shall return an <code>XDSStoredQueryParamNumber</code> error (see error codes) if more than one of these parameters are specified.</p>"},{"location":"transactions/iti18/#getfolders","title":"GetFolders","text":"<p>The response is empty, as folders are not implemented. A warning is added to the response.</p>"},{"location":"transactions/iti18/#getassociations","title":"GetAssociations","text":"<p>This stored query allows to fetch <code>Association</code> objects whose <code>sourceObject</code> or <code>targetObject</code> match the <code>$uuid</code> parameter. All the IHE profile parameters are supported.</p> Parameter Name Required Remarks <code>$uuid</code> yes - <code>$homeCommunityId</code> no - <code>$XDSAssociationStatus</code> no Associations in the eMedication service can only be <code>Approved</code>. If empty, <code>Approved</code> will be assumed"},{"location":"transactions/iti18/#getdocumentsandassociations","title":"GetDocumentsAndAssociations","text":"<p>This stored query allows to retrieve a collection of <code>XDSDocumentEntry</code> objects and the <code>Association</code> objects related to them (i.e. the <code>Association</code> <code>sourceObject</code> or <code>targetObject</code> must be one of the fetched <code>XDSDocumentEntry</code> objects), that is, a combination of the GetDocuments and GetAssociations queries. All the IHE profile parameters are supported.</p> Parameter Name Required Remarks <code>$XDSDocumentEntryEntryUUID</code> no<sup>*</sup> - <code>$XDSDocumentEntryUniqueId</code> no<sup>*</sup> - <code>$homeCommunityId</code> no - <code>$XDSAssociationStatus</code> no Associations in the eMedication service can only be <code>Approved</code>. If empty, <code>Approved</code> will be assumed <p><sup>*</sup> Either <code>$XDSDocumentEntryEntryUUID</code> or <code>$XDSDocumentEntryUniqueId</code> shall be specified. This transaction shall return an <code>XDSStoredQueryParamNumber</code> error (see error codes) if more than one of these parameters are specified.</p>"},{"location":"transactions/iti18/#getsubmissionsets","title":"GetSubmissionSets","text":"<p>This stored query allows to retrieve a collection of <code>XDSSubmissionSet</code> objects from the registry used to submit the specified document entries as parameters. All the IHE profile parameters are supported.</p> Parameter Name Required Remarks <code>$uuid</code> yes matched against <code>XDSDocumentEntry.entryUUID</code> <code>$homeCommunityId</code> no -"},{"location":"transactions/iti18/#getsubmissionsetandcontents","title":"GetSubmissionSetAndContents","text":"<p>This stored query allows to fetch specific <code>SubmissionSet</code> objects and their associated objects, returning: - All <code>SubmissionSet</code> objects matching the query\u2019s criteria. - <code>DocumentEntry</code> objects linked to the matching <code>SubmissionSet</code> objects by <code>HasMember</code> associations, as long as they also meet all other present criteria in the query. - Said <code>HasMember</code> <code>Association</code> objects.</p> <p>All the IHE profile parameters are supported.</p> Parameter Name Required Remarks <code>$XDSSubmissionSetEntryUUID</code> no<sup>*</sup> - <code>$XDSSubmissionSetUniqueId</code> no<sup>*</sup> - <code>$XDSDocumentEntryFormatCode</code> no See the ITI-41 section in this guide <code>$XDSDocumentEntryConfidentialityCode</code> no All documents in the eMedication service are set to <code>Normal</code>. See the Annex 3 of the EPR Act, section 2.8 <code>$homeCommunityId</code> no - <code>$XDSDocumentEntryType</code> no If empty, <code>Stable</code> will be assumed <p>Either <code>$XDSSubmissionSetEntryUUID</code> or <code>$XDSSubmissionSetUniqueId</code> shall be specified. This transaction shall return an <code>XDSStoredQueryParamNumber</code> error (see error codes) if both parameters are specified. </p>"},{"location":"transactions/iti18/#getfolderandcontents","title":"GetFolderAndContents","text":"<p>The response is empty, as folders are not supported. A warning is added to the response.</p>"},{"location":"transactions/iti18/#getfoldersfordocument","title":"GetFoldersForDocument","text":"<p>The response is empty, as folders are not supported. A warning is added to the response.</p>"},{"location":"transactions/iti18/#getrelateddocuments","title":"GetRelatedDocuments","text":"<p>This stored query allows to fetch <code>XDSDocumentEntry</code> objects that are related to the specified document via <code>Association</code> objects satisfying all the following conditions:</p> <ul> <li>The <code>sourceObject</code> attribute or the <code>targetObject</code> attribute references the specified document.</li> <li>The <code>sourceObject</code> and the <code>targetObject</code> attributes reference documents.</li> <li>The <code>associationType</code> attribute matches a value included in the <code>$AssociationTypes</code> parameter. See Association Types.</li> </ul> <p>Matching associations are also included in the result set, along with the <code>XDSDocumentEntry</code> objects referenced by the <code>sourceObject</code> or <code>targetObject</code> attributes of the matching associations.</p> <p>Note, therefore, that if a <code>DocumentEntry</code> is not part of an association between two documents, it will not be returned by the query.</p> <p>All the IHE profile parameters are supported.</p> Parameter Name Required Remarks <code>$XDSDocumentEntryEntryUUID</code> no<sup>*</sup> - <code>$XDSDocumentEntryUniqueId</code> no<sup>*</sup> - <code>$AssociationTypes</code> yes Only <code>RPLC</code> and <code>HasMember</code> are supported by the eMedication service <code>$homeCommunityId</code> no - <code>$XDSDocumentEntryType</code> no If empty, <code>Stable</code> will be assumed <code>$XDSAssociationStatus</code> no Associations in the eMedication service can only be <code>Approved</code>. If empty, <code>Approved</code> will be assumed <p><sup>*</sup> Either <code>$XDSDocumentEntryEntryUUID</code> or <code>$XDSDocumentEntryUniqueId</code> shall be specified. This transaction shall return an <code>XDSStoredQueryParamNumber</code> error (see error codes) if more than one of these parameters are specified.</p>"},{"location":"transactions/iti18/#finddocumentsbyreferenceid","title":"FindDocumentsByReferenceId","text":"<p>The response is empty, since the <code>Reference ID</code> option is not supported. A warning is added to the response.</p>"},{"location":"transactions/iti18/#error-codes","title":"Error codes","text":"<p>Specific codes not covered by generic codes.</p> XDS error code Details <code>XDSStoredQueryMissingParam</code> If a required search parameter is missing <code>XDSStoredQueryParamNumber</code> If too many/too much search parameters are provided <code>XDSUnknownStoredQuery</code> If the search query is unknown <code>XDSRegistryError</code> If the search query is known but unsupported <code>XDSRegistryMetadataError</code> If <code>$MetadataLevel</code> is not \u201c1\u201d"},{"location":"transactions/iti20/","title":"Record Audit Event [ITI-20]","text":"<p>Audit events, as specified by IHE\u2019s Audit Trail and Node Authentication (ATNA) profile, are required by the Swiss EPR regulations. To align with these, the eMedication service complies itself with these regulations and has its own an Audit Record Repository for all ATNA logs related to the service. Clients of the eMedication service MUST record the necessary audit events during each transaction with the eMedication service by means of an ITI-20 transaction to the endpoint exposed by the eMedication service\u2019s Audit Record Repository (see the endpoints page).</p>"},{"location":"transactions/iti20/#recording-audit-events","title":"Recording audit events","text":"<p>The eMedication service supports only syslog messages. RESTful ATNA support is foreseen but not available for the time being.</p>"},{"location":"transactions/iti20/#syslog-interaction","title":"Syslog Interaction","text":"<p>The eMedication service exposes a TCP port (see the endpoints page). This port accepts only two-way TLS connections and will process only syslog messages that comply with the ITI-20 profile. All valid syslog messages, as per IHE\u2019s profile, are recorded in the eMedication Audit Record Repository.</p> <p>Additionally, the Audit Record Repository will try to translate, if possible and as a best effort, all received audit messages to FHIR AuditEvent objects and more specifically, to CH ATC compliant <code>AuditEvent</code> objects. Note that it is the responsability of the systems recording audit events to generate complete and compliant messages as per the regulations and that the Audit Record Repository offers some basic transformations to help with CH ATC compliance as a nice-to-have extra on a best-effort basis and not as an obligation.</p>"},{"location":"transactions/iti20/#restful-atna-feed","title":"RESTful ATNA Feed","text":"<p>The audit record repository supports the FHIR feed of <code>AuditEvent</code> resources. Although a validation (and when possible, certain transformations to improve compliance) against CH EPR FHIR or CH:ATC profiles is done, no audit events are rejected in case of no-conformities. The feed is simply done by performing a create interaction, as defined by the FHIR standard, posting an <code>AuditEvent</code> resource to the relevant endpoint.</p>"},{"location":"transactions/iti41/","title":"ITI-41","text":"<p>The ITI-41 (Provide and Register Document Set-b) transaction allows a content sender to send documents to the eMedication service (content receiver). </p> <p>Generic DocumentEntry metadata are described in the documents section. This page references additional constraints specific to ITI-41. </p> <p>See also IHE\u2019s documentation for metadata in Document Sharing profiles as well as EPD by example\u2019s Provide and Register Document Set page.</p>"},{"location":"transactions/iti41/#publishing-documents","title":"Publishing documents","text":""},{"location":"transactions/iti41/#document-types","title":"Document types","text":"<p>Two types of documents might be published to the service:</p> <ul> <li>CH EMED EPR documents (MTP, PRE, DIS and PADV only, PML and PMLC can only be retrieved from the service and not published to it). These documents contain the eMedication data. See also the corresponding page in this guide.</li> <li>APPC (Advanced Patient Privacy Consent) documents. These documents are used to let patients define access rights to their data (who can publish and retrieve their data). See also the corresponding page in this guide.</li> </ul>"},{"location":"transactions/iti41/#submissionset-and-relations","title":"SubmissionSet and relations","text":"<p>The eMedication service does not support folders and can only receive ONE document at a time. Hence, the metadata must always contain a SubmissionSet with a single DocumentEntry.</p> <p>Only the following associations are supported:</p> Association Type Usage urn:oasis:names:tc:ebxml-regrep:AssociationType:HasMember To link a DocumentEntry to the SubmissionSet. urn:ihe:iti:2007:AssociationType:RPLC To replace a previously published document. Replaced document becomes deprecated."},{"location":"transactions/iti41/#uniqueness","title":"Uniqueness","text":"<p>Documents can be sent to the eMedication service only once. Uniqueness is checked against DocumentEntry\u2019s unique Id, that must be an UUID and DocumentEntry\u2019s entryUUID.</p>"},{"location":"transactions/iti41/#metadata","title":"Metadata","text":"<p>This section describes the rules applicable for any document\u2019s type metadata.</p>"},{"location":"transactions/iti41/#submissionset-metadata","title":"SubmissionSet metadata","text":"<p>See also the IHE SubmissionSet Metadata Attributes diagram or the IHE SubmissionSet Attributes section.</p> Metadata Opt Rules <code>uniqueId</code> R Must be an OID. Can be used only once and must be globally unique. <code>author</code> R Multiple values accepted. <code>author.authorRole</code> R Possible values are defined in CH Term IG. For APPC, only <code>PAT</code> (patient) and <code>REP</code> (Representative) are allowed. <code>author.authorSpecialty</code> O Possible values are defined in CH Term IG. <code>availabilityStatus</code> O The value set in the metadata is always ignored, and replaced by <code>approved</code>. <code>comments</code> O - <code>contentTypeCode</code> R Possible values are defined in CH Term IG. Use <code>application/fhir+json</code> or <code>application/fhir+xml</code> for CH EMED EPR documents, and <code>text/xml</code> for APPC. <code>entryUUID</code> R Must be globally unique. <code>homeCommunityId</code> O Not used. Can be left blank or omitted. <code>intendedRecipient</code> O Not used. Can be left blank or omitted. <code>limitedMetadata</code> O Must be left bank or omitted. <code>patientId</code> R Must be a XAD-PID. <code>sourceId</code> R Globally unique and immutable OID identifier of the source. <code>submissionTime</code> R HL7 DTM value in UTC. <code>title</code> O -"},{"location":"transactions/iti41/#documententry-metadata","title":"DocumentEntry metadata","text":"<p>See also the DocumentEntry Metadata Attributes diagram.</p> Metadata Opt Rules <code>author.authorRole</code> R Possible values are defined in CH Term IG. For APPC, only <code>PAT</code> (patient) and <code>REP</code> (Representative) are allowed. Must be aligned with document content author (see below). <code>author.authorSpecialty</code> O Possible values are defined in CH Term IG. Must be aligned with document content author (see below). <code>availabilityStatus</code> O The value set in the metadata is always ignored, and replaced by <code>approved</code>. <code>classCode</code> R See CH EMED EPR and APPC sections below. <code>comments</code> O - <code>confidentialityCode</code> R Confidentiality level in the DocumentEntry metadata is forced to <code>Normal</code>. <code>creationTime</code> R HL7 DTM value in UTC. Must match document content creation time (see below). <code>deletionStatus</code> O If present, deletionStatus must be <code>urn:e-health-suisse:2019:deletionStatus:deletionNotRequested</code>. <code>documentAvailability</code> O If present should be <code>Online</code>. <code>entryUUID</code> R Must be globally unique. <code>eventCodeList</code> O See the list of available codes. <code>formatCode</code> R See CH EMED EPR and APPC sections below. <code>hash</code> O Hash of the document content. <code>healthcareFacilityTypeCode</code> R See the list of available codes. <code>homeCommunityId</code> O - <code>languageCode</code> R See the list of available codes. <code>legalAuthenticator</code> O - <code>limitedMetadata</code> O Must be left bank or omitted. <code>logicalId</code> O Shall be present when replacing a document. <code>mimeType</code> O Possible values are defined CH Term IG. Use <code>application/fhir+json</code> or <code>application/fhir+xml</code> for CH EMED EPR documents, and <code>text/xml</code> for APPC. <code>objectType</code> R Value is ignored and set to <code>Stable</code>. <code>patientId</code> R Must match <code>SubmissionSet.patientId</code> and be a XAD-PID (see above). <code>practiceSettingCode</code> R See the list of available codes. <code>referenceIdList</code> O Must be omitted or empty as referencing external documents is not permitted (see Referencing external documents section). <code>repositoryUniqueId</code> O If the attribute <code>repositoryUniqueId</code> is present and does not correspond to the <code>repositoryUniqueId</code> the relevant document repository OID, the request is rejected. <code>serviceStartTime</code> O Given as an HL7 DTM in UTC. Shall be empty for APPC <code>serviceStopTime</code> O Given as an HL7 DTM in UTC. Shall be empty for APPC <code>size</code> O - <code>sourcePatientId</code> R Any id known or unknown to the local MPI. EPR-SPID and SSN are forbidden. <code>sourcePatientInfo</code> O Ignored by the service. <code>title</code> R - <code>typeCode</code> R See section below. <code>uniqueId</code> R Must be globally unique and be a UUID. Must match the document id in the case of CH EMED EPR documents. <code>URI</code> O - <code>version</code> O If present shall be empty, the value is ignored and set by the document registry."},{"location":"transactions/iti41/#publishing-a-ch-emed-epr-document","title":"Publishing a CH EMED EPR document","text":"<p>This section details the specific rules to follow when publishing CH EMED EPR documents.</p> <p>Only MTP, PRE, DIS and PADV docs can be published. PML and PMLC can only be retrieved from the service.</p>"},{"location":"transactions/iti41/#referencing-external-documents","title":"Referencing external documents","text":"<p>When publishing CH EMED EPR documents, all references (from the key elements) shall be known to the eMedication service. All non-key elements are ignored by the eMedication service. </p> <p>This implies that the metadata cannot contain Reference ids. This option is not supported, and submission of a reference to an existing document is forbidden.</p>"},{"location":"transactions/iti41/#creation-times","title":"Creation times","text":"<p>Creation time of a document must be equal or greater than the creation time of the last document of the treatment chain, ie. the last published document targeting the treatment (either the original MTP if no other document, or the last document published referencing this treatment).</p> <ul> <li>Creation time of the document has to be in the past.</li> <li>All references to other documents or items have to refer to existing approved non deleted documents.</li> </ul>"},{"location":"transactions/iti41/#rules-for-each-type-of-document","title":"Rules for each type of document","text":""},{"location":"transactions/iti41/#mtp","title":"MTP","text":"<ul> <li>The medication referenced in the MTP (<code>CHEMEDEPRMedicationStatement</code>) should follow some rules. These are detailed in the implementation guide\u2019s treatment guidance page.</li> </ul>"},{"location":"transactions/iti41/#pre","title":"PRE","text":"<ul> <li>Each PRE item should refer to an MTP item (<code>CHEMEDEPRMedicationRequest.treatmentplan</code>) that must:<ul> <li>Exist (has already been published, and never deleted)</li> <li>Be approved, ie. <code>DocumentEntry.availabilityStatus = approved</code>, </li> <li>Preferably be valid, i.e. the submission date should be within the MTP <code>dosage</code>\u2019s <code>boundsPeriod</code> (<code>CHEMEDEPRDosage.repeat.bounds</code>).<ul> <li>If the <code>boundsPeriod</code> is not defined, the entry is considered to be always active.</li> <li>If only a <code>startDate</code> is specified, the MTP is considered to be active if the current date is after that date.</li> </ul> </li> <li>Active, ie. <code>CHEMEDEPRDocumentMedicationTreatmentPlan.CHEMEDEPRMedicationStatement.status = active</code></li> <li>For the same patient.</li> </ul> </li> <li>Code of medication should match the code of medication of the MTP referenced by the PRE (<code>CHEMEDEPRMedicationRequest.treatmentplan</code>). This rule is not enforced and might be extended in the future.    </li> <li>If lot number (<code>CHEMEDEPRMedication.batch</code>) is specified in referenced MTP, the one in the PRE (<code>CHEMEDEPRMedicationRequest.medication[x]:medicationReference.batch</code>) should match it.  This rule is not enforced and might be extended in the future.</li> </ul>"},{"location":"transactions/iti41/#padv","title":"PADV","text":""},{"location":"transactions/iti41/#padv-against-a-provisional-pre","title":"PADV against a provisional PRE","text":"<p>A \u201cprovisional PRE\u201d is a prescription for which the <code>CHEMEDEPRMedicationRequest.status</code> is <code>SUBMITTED</code> or <code>PROVISIONAL</code> and for which a <code>PADV</code> <code>OK</code> has not been completed yet.</p> <ul> <li>Medication cannot be changed. This rule is not enforced and might be extended in the future.</li> <li>Dosage instructions cannot be changed.  This rule is not enforced and might be extended in the future.</li> <li>Substitution cannot be disallowed if the existing dispense includes one.  This rule is not enforced and might be extended in the future.</li> <li>Observation code <code>REFUSE</code> cannot be issued.</li> </ul>"},{"location":"transactions/iti41/#padv-cancel","title":"PADV CANCEL","text":"<ul> <li>Sets status to <code>CANCELED</code>.</li> <li>Not allowed against <code>DIS</code> or other <code>PADV</code> documents.</li> </ul>"},{"location":"transactions/iti41/#against-mtp","title":"Against MTP","text":"<ul> <li>Also set related prescriptions\u2019 status to <code>CANCELED</code> if their status was not already <code>REFUSED</code> or <code>CANCELED</code>.</li> <li>Treatment plan status must be <code>ACTIVE</code> or <code>SUSPENDED</code>.</li> </ul>"},{"location":"transactions/iti41/#against-pre","title":"Against PRE","text":"<ul> <li>Not allowed for prescriptions whose status is already <code>CANCELED</code> or <code>REFUSED</code>.</li> <li>Not allowed to target anything else than <code>MTP</code> or <code>PRE</code></li> </ul>"},{"location":"transactions/iti41/#padv-ok","title":"PADV OK","text":"<ul> <li>Sets targeted <code>MTP</code> or <code>PRE</code> status to <code>ACTIVE</code>.</li> <li>Against <code>MTP</code>: only allowed for treatment plans with status <code>ACTIVE</code> or <code>SUSPENDED</code>.</li> <li>Against <code>PRE</code>: only allowed for prescriptions with status <code>SUBMITTED</code> or <code>PROVISIONAL</code>.</li> <li><code>PADV OK</code> cannot target anything else than <code>MTP</code> or <code>PRE</code>.</li> </ul>"},{"location":"transactions/iti41/#padv-change","title":"PADV CHANGE","text":"<ul> <li>Changes the treatment plan or prescription.</li> <li>Can only target <code>MTP</code> or <code>PRE</code>.</li> </ul>"},{"location":"transactions/iti41/#against-mtp_1","title":"Against MTP","text":"<ul> <li>The treatment status must be <code>ACTIVE</code> or <code>SUSPENDED</code>.</li> <li>The treatment must not have been prescribed.</li> <li>Additionally, the treatment\u2019s status is set to <code>ACTIVE</code> as a result of the aggregation.</li> </ul>"},{"location":"transactions/iti41/#against-pre_1","title":"Against PRE","text":"<ul> <li>The prescription\u2019s status must not be <code>CANCELED</code> or <code>REFUSED</code>.</li> <li>If the prescription\u2019s status is <code>SUBMITTED</code>, the aggregation sets it to <code>ACTIVE</code> as a result.</li> </ul>"},{"location":"transactions/iti41/#padv-refuse","title":"PADV REFUSE","text":"<ul> <li>Sets status to <code>REFUSED</code>.</li> </ul>"},{"location":"transactions/iti41/#against-mtp_2","title":"Against MTP","text":"<ul> <li>Sets also related prescriptions\u2019 status to <code>REFUSED</code> if the status was not already <code>REFUSED</code> or <code>CANCELED</code>.</li> <li>Treatment\u2019s status must be <code>ACTIVE</code> or <code>SUSPENDED</code>.</li> </ul>"},{"location":"transactions/iti41/#against-pre_2","title":"Against PRE","text":"<ul> <li>The prescription\u2019s status must not be <code>REFUSED</code>, <code>CANCELED</code> or <code>PROVISIONAL</code>.</li> <li>Cannot target anything else than <code>MTP</code> or <code>PRE</code>.</li> </ul>"},{"location":"transactions/iti41/#padv-suspend","title":"PADV SUSPEND","text":"<ul> <li>Sets status to <code>SUSPENDED</code></li> <li>Only allowed to target <code>MTP</code> entries</li> <li>The treatment status must be <code>ACTIVE</code></li> </ul>"},{"location":"transactions/iti41/#padv-comment","title":"PADV COMMENT:","text":"<ul> <li>Can target <code>MTP</code>, <code>PRE</code> and <code>DIS</code> entries only.</li> </ul>"},{"location":"transactions/iti41/#dis","title":"DIS","text":"<ul> <li>If lot number (<code>batch</code>) is specified in referenced MTP(<code>treatmentPlan</code>) or PRE (<code>prescription</code>), then it should match the one in the DIS if substitution is not allowed.  This rule is not enforced and might be extended in the future.</li> </ul>"},{"location":"transactions/iti41/#dis-against-mtp-or-pre-mtp","title":"DIS against MTP or PRE + MTP:","text":"<ul> <li>Medication should not be different if substitution is not allowed by PRE. This rule might be extended in the future. </li> <li>Dispense should not occur after the end of validity of the PRE document. This rule might be extended in the future.</li> <li>Dispense should not occur after the end of the treatment if specified in the prescription item. This rule might be extended in the future.</li> <li>If referenced PRE is not provisional, it should be <code>dispensable</code> (that is have status either <code>PROVISIONAL</code> or <code>ACTIVE</code>). This rule is not enforced and might be extended in the future.</li> <li>List of active ingredients should be the same than the one in the referenced PRE (<code>prescription</code>). This rule is not enforced and might be extended in the future.</li> <li>If the treatment has been prescribed (at least one PRE document has been successfully submitted for it), then any DIS document targeting this treatment must reference one of its prescriptions as well.</li> </ul>"},{"location":"transactions/iti41/#roles","title":"Roles","text":"<ul> <li>Patients and their representatives are allowed to publish only the following type of docs:<ul> <li>MTP</li> <li>PADV with a <code>COMMENT</code> observation code with no restriction.</li> <li>PADV with any other observation code only when referencing a document published by the same patient or a representative of the same patient.     </li> </ul> </li> <li>Healthcare professionals are allowed to publish only the following types of docs:<ul> <li>MTP</li> <li>PRE</li> <li>DIS</li> <li>PADV      </li> </ul> </li> </ul>"},{"location":"transactions/iti41/#metadata-values-check","title":"Metadata values check","text":"<p>Some values from the DocumentEntry are checked against the document (values in metadata and document must be equal):</p> DocumentEntry CH EMED EPR author <code>Composition.author</code> classCode <code>Composition.type</code>.  Must be consistent with the document type (see below) creationTime <code>Composition.date</code> formatCode Must be consistent with the document type (see below) languageCode <code>Composition.language</code> mimeType <code>application/fhir+xml</code> or <code>application/fhir+json</code> typeCode Must be consistent with the document type (see below) uniqueId <code>Bundle.identifier.value</code> and <code>Composition.identifier.value</code>"},{"location":"transactions/iti41/#metadata-codes-per-document-type","title":"Metadata codes per document type","text":"Document type DocumentEntry.classCode DocumentEntry.formatCode DocumentEntry.typeCode MTP <code>734163000</code> Care plan (record artifact) <code>urn:che:epr:ch-emed:mtp:2024</code> <code>761931002</code> Medication treatment plan report (record artifact) PRE <code>440545006</code> Prescription record <code>urn:che:epr:ch-emed:pre:2024</code> <code>761938008</code> Medicinal Prescription record (record artifact) DIS <code>417319006</code> Record of health event (record artifact) <code>urn:che:epr:ch-emed:dis:2024</code> <code>82291000195104</code> Medication dispense document (record artifact) PADV <code>440545006</code> Prescription record <code>urn:che:epr:ch-emed:padv:2024</code> <code>419891008</code> Record artifact PML <code>422735006</code> Summary clinical document (record artifact) <code>urn:che:epr:ch-emed:pml:2024</code> <code>721912009</code> Medication summary document PMLC <code>422735006</code> Summary clinical document (record artifact) <code>urn:che:epr:ch-emed:medication-card:2023</code> <code>736378000</code> Medication management plan (record artifact) <p>The class and type codes are from the SNOMED CT system: <code>2.16.840.1.113883.6.96</code>. The system for the <code>formatCode</code> is <code>2.16.756.5.30.1.127.3.10.10</code></p>"},{"location":"transactions/iti41/#replacing-a-ch-emed-epr-document","title":"Replacing a CH EMED EPR document","text":"<p>The following rules must be observed when replacing a document:</p> <ul> <li>Patients and their representatives can only replace a document published by the same patient.<ul> <li>representatives are not supported by the service yet.</li> </ul> </li> <li>Healthcare professionals (HCP) can only replace a document published by himself or by another HCP of same community of affiliation.<ul> <li>Current implementation: an HCP can replace a document published by any other HCP. Further rules and possible implementations are under discussion.</li> </ul> </li> <li>Document administrator may only replace a document published by an HCP of the same community of affiliation.<ul> <li>Not implemented in PMP, to be discussed, for now a document admin can replace any document.</li> </ul> </li> <li>Replacing and replaced documents have to be of the same type (e.g. both MTP documents).</li> <li>Replacing and replaced documents have to refer to the same patient.</li> <li>Only documents at the end of a treatment chain can be replaced.</li> <li>Replaced document must exist in the repository.</li> <li>A replacement document must can be linked only to elements of the same medication chain. In case a PRE document is replaced, it may be linked only to elements of the medication chain of the referenced MTP. </li> <li>Document administrator can replace any document regardless of who published it.</li> <li>Replaced document must be approved (although this is always the case after an initial ITI-41 transaction, documents might become <code>deprecated</code> after another ITI-41 transaction with a replacement association).</li> <li>Replaced document must not have <code>deletionStatus = deletionRequested</code> (this is relevant since although it is not the case at the moment with the current implementation, there might be files in the repository flagged for deletion but not deleted yet).</li> </ul>"},{"location":"transactions/iti41/#publishing-a-pmp-appc-document","title":"Publishing a PMP-APPC document","text":"<p>This section details the rules applicable to metadata when publishing APPC documents.</p>"},{"location":"transactions/iti41/#rules-for-appc","title":"Rules for APPC","text":"<ul> <li>Only  Patients and their representatives or policy administrators can publish a new APPC document.<ul> <li>representatives are not supported by the service yet.</li> </ul> </li> <li>Only Patients and their representatives can replace their own APPC documents (if it exists).<ul> <li>representatives are not supported by the service yet.</li> </ul> </li> <li>Policy administrators of the reference community of the patient can replace any existing APPC document.</li> <li>No APPC for the specified patient exists in the system (unless the published document is a replacement), otherwise the document is refused.</li> <li>As for CH EMED EPR, APPC documents to be replaced must:<ul> <li>Be approved (as before, this is always the case for documents in the PMP repository when they are published, but their status might change to deprecated after a replacement).</li> <li>Not have <code>deletionStatus = deletionRequested</code>.</li> </ul> </li> <li>APPC document structure is described in Implementation Guide for eMedication architecture in the context  of the EPR, section \u00a77.5<ul> <li><code>1 Description</code> section for free text description of the policy set</li> <li><code>1 Target</code> section containing:<ul> <li><code>1 Resources</code> section containing <code>1 Resource</code> object pointing to the patient by indicating the <code>EPR-SPID</code>.</li> <li><code>* Subjects</code> sections each one containing themselves <code>Subject</code> entries each defining 1 \u201cwho\u201d. Subject cannot be the patient.</li> <li><code>* Environments</code> sections each one containing one <code>Environment</code> object limiting the validity period of the policy.<ul> <li>Required if at least one <code>Subject</code> refers to an organization or group.<ul> <li>Specs state \u201cThis section will not be used within this context.\u201d</li> </ul> </li> </ul> </li> <li>A list of <code>PolicyIdReference</code> or <code>PolicySetIdReference</code> defining the level of access granted to the users identified by the Subjects section.<ul> <li>See 7.5 for the list of policies that can be used.</li> </ul> </li> <li><code>*</code> embedded <code>PolicySet</code> sections containing:<ul> <li><code>1..* Subjects</code> sections containing themselves <code>Subject entries</code> and each defines one \u201cwho\u201d.</li> <li><code>* Environments</code> (same as above)</li> </ul> </li> </ul> </li> </ul> </li> </ul>"},{"location":"transactions/iti41/#appc-metadata","title":"APPC metadata","text":"DocumentEntry APPC Code System classCode <code>371537001</code> Consent report (record artifact) 2.16.840.1.113883.6.96 formatCode <code>urn:ihe:iti:appc:2016:consent</code> 1.3.6.1.4.1.19376.1.2.3 mimeType <code>text/xml</code> serviceStartTime None serviceStopTime None typeCode <code>419891008</code> Record artifact (record artifact) 2.16.840.1.113883.6.96"},{"location":"transactions/iti43/","title":"ITI-43","text":"<p>The ITI-43 (Retrieve Document Set) transaction allows a Document Consumer to retrieve a set of documents. </p> <p>This transaction, implemented as per the specifications. All documents are retrievable with an ITI-43 transaction (with the proper access rights: only patients, representatives and policy administrators can retrieve APPC (Advanced Patient Privacy Consent) documents).</p> <p>See also EPD by example\u2019s Retrieve Document Set page.</p>"},{"location":"transactions/iti43/#on-demand-documents","title":"On-demand documents","text":"<p>Generation rules for CH EMED EPR PML (Medication List) and PMLC (Medication Card) documents are described in the CH EMED EPR IG.</p>"},{"location":"transactions/iti43/#samples","title":"Samples","text":""},{"location":"transactions/iti43/#emed","title":"EMED","text":""},{"location":"transactions/iti43/#request","title":"Request","text":"<p><code>Header</code> <pre><code>POST https://test.ahdis.ch/eprik-cara/camel/pmp-int/mag-pmp-int/pmp/services/xds/iti43 HTTP/1.1\nhost: test.ahdis.ch\nx-request-id: 9e267acd6864a09d5b00e782e3b49423\nx-real-ip: 188.154.194.120\nx-forwarded-host: test.ahdis.ch\nx-forwarded-port: 443\nx-forwarded-proto: https\nx-forwarded-scheme: https\nx-scheme: https\ncontent-length: 8920\ncontent-type: multipart/related; type=\"application/xop+xml\"; boundary=\"uuid:fe38a46e-a89a-4810-856a-28f5b866b9d8\"; start=\"&lt;root.message@cxf.apache.org&gt;\"; start-info=\"application/soap+xml\"\naccept: */*\nuser-agent: Apache-CXF/3.6.2\ncache-control: no-cache\npragma: no-cache\n</code></pre></p> <p><code>Body</code> <pre><code>--uuid:fe38a46e-a89a-4810-856a-28f5b866b9d8\nContent-Type: application/xop+xml; charset=UTF-8; type=\"application/soap+xml\"\nContent-Transfer-Encoding: binary\nContent-ID: &lt;root.message@cxf.apache.org&gt;\n\n&lt;soap:Envelope xmlns:soap=\"http://www.w3.org/2003/05/soap-envelope\"&gt;\n  &lt;soap:Header&gt;\n    &lt;wsse:Security xmlns:wsse=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\"&gt;\n      &lt;saml2:Assertion xmlns:saml2=\"urn:oasis:names:tc:SAML:2.0:assertion\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" ID=\"_ef4ef6e0-4d28-43cf-8b02-45855b6b5341\" IssueInstant=\"2025-10-24T14:10:58.082024400Z\" Version=\"2.0\"&gt;\n        &lt;saml2:Issuer&gt;http://ith-icoserve.com/eHealthSolutionsSTS&lt;/saml2:Issuer&gt;\n        &lt;ds:Signature xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\"&gt;\n          &lt;ds:SignedInfo&gt;\n            &lt;ds:CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/&gt;\n            &lt;ds:SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\"/&gt;\n            &lt;ds:Reference URI=\"#_ef4ef6e0-4d28-43cf-8b02-45855b6b5341\"&gt;\n              &lt;ds:Transforms&gt;\n                &lt;ds:Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/&gt;\n                &lt;ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"&gt;\n                  &lt;ec:InclusiveNamespaces xmlns:ec=\"http://www.w3.org/2001/10/xml-exc-c14n#\" PrefixList=\"xsd\"/&gt;\n                &lt;/ds:Transform&gt;\n              &lt;/ds:Transforms&gt;\n              &lt;ds:DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\"/&gt;\n              &lt;ds:DigestValue&gt;U9hLZugp8YvFib3TUavtzZzYCRROaPgl5LkuYJ2ttJ8=&lt;/ds:DigestValue&gt;\n            &lt;/ds:Reference&gt;\n          &lt;/ds:SignedInfo&gt;\n          &lt;ds:SignatureValue&gt;[Signature removed for better readability]&lt;/ds:SignatureValue&gt;\n          &lt;ds:KeyInfo&gt;\n            &lt;ds:X509Data&gt;\n              &lt;ds:X509Certificate&gt;[Certificate removed for better readability]&lt;/ds:X509Certificate&gt;\n            &lt;/ds:X509Data&gt;\n          &lt;/ds:KeyInfo&gt;\n        &lt;/ds:Signature&gt;\n        &lt;saml2:Subject&gt;\n          &lt;saml2:NameID Format=\"urn:oasis:names:tc:SAML:2.0:nameid-format:persistent\" NameQualifier=\"urn:e-health-suisse:2015:epr-spid\"&gt;761337618116306629&lt;/saml2:NameID&gt;\n          &lt;saml2:SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\"&gt;\n            &lt;saml2:SubjectConfirmationData InResponseTo=\"ID_fcbfa1e0-7d47-49a2-8d21-f5bd98cd88a7\" NotOnOrAfter=\"2025-10-24T14:14:41.829Z\" Recipient=\"https://ws-pmp-int.cara.ch/iua\"/&gt;\n          &lt;/saml2:SubjectConfirmation&gt;\n        &lt;/saml2:Subject&gt;\n        &lt;saml2:Conditions NotBefore=\"2025-10-24T14:09:40.829Z\" NotOnOrAfter=\"2025-10-24T14:14:41.829Z\"&gt;\n          &lt;saml2:AudienceRestriction&gt;\n            &lt;saml2:Audience&gt;urn:e-health-suisse:token-audience:all-communities&lt;/saml2:Audience&gt;\n          &lt;/saml2:AudienceRestriction&gt;\n        &lt;/saml2:Conditions&gt;\n        &lt;saml2:AuthnStatement AuthnInstant=\"2025-10-24T14:09:41.829Z\"&gt;\n          &lt;saml2:AuthnContext&gt;\n            &lt;saml2:AuthnContextClassRef&gt;urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport&lt;/saml2:AuthnContextClassRef&gt;\n          &lt;/saml2:AuthnContext&gt;\n        &lt;/saml2:AuthnStatement&gt;\n        &lt;saml2:AttributeStatement&gt;\n          &lt;saml2:Attribute Name=\"urn:oasis:names:tc:xspa:1.0:subject:subject-id\"&gt;\n            &lt;saml2:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xsd:string\"&gt;MARIJE GOTTSPONER&lt;/saml2:AttributeValue&gt;\n          &lt;/saml2:Attribute&gt;\n          &lt;saml2:Attribute Name=\"urn:oasis:names:tc:xacml:2.0:subject:role\"&gt;\n            &lt;saml2:AttributeValue&gt;\n              &lt;Role xmlns=\"urn:hl7-org:v3\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" code=\"PAT\" codeSystem=\"2.16.756.5.30.1.127.3.10.6\" codeSystemName=\"eHealth Suisse EPR Actors\" displayName=\"Patient\" xsi:type=\"CE\"/&gt;\n            &lt;/saml2:AttributeValue&gt;\n          &lt;/saml2:Attribute&gt;\n          &lt;saml2:Attribute Name=\"urn:oasis:names:tc:xspa:1.0:subject:organization-id\"/&gt;\n          &lt;saml2:Attribute Name=\"urn:oasis:names:tc:xspa:1.0:subject:organization\"/&gt;\n          &lt;saml2:Attribute Name=\"urn:oasis:names:tc:xspa:1.0:subject:purposeofuse\"&gt;\n            &lt;saml2:AttributeValue&gt;\n              &lt;PurposeOfUse xmlns=\"urn:hl7-org:v3\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" code=\"NORM\" codeSystem=\"2.16.756.5.30.1.127.3.10.5\" codeSystemName=\"eHealth Suisse Verwendungszweck\" displayName=\"Normal Access\" xsi:type=\"CE\"/&gt;\n            &lt;/saml2:AttributeValue&gt;\n          &lt;/saml2:Attribute&gt;\n          &lt;saml2:Attribute Name=\"urn:oasis:names:tc:xacml:2.0:resource:resource-id\"&gt;\n            &lt;saml2:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xsd:string\"&gt;761337618116306629^^^&amp;amp;2.16.756.5.30.1.127.3.10.3&amp;amp;ISO&lt;/saml2:AttributeValue&gt;\n          &lt;/saml2:Attribute&gt;\n          &lt;saml2:Attribute Name=\"urn:ihe:iti:xca:2010:homeCommunityId\" NameFormat=\"urn:oasis:names:tc:SAML:2.0:attrname-format:uri\"&gt;\n            &lt;saml2:AttributeValue xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xsd:anyURI\"&gt;urn:oid:2.16.756.5.30.1.191.1.0&lt;/saml2:AttributeValue&gt;\n          &lt;/saml2:Attribute&gt;\n        &lt;/saml2:AttributeStatement&gt;\n      &lt;/saml2:Assertion&gt;\n    &lt;/wsse:Security&gt;\n    &lt;Action soap:mustUnderstand=\"true\" xmlns=\"http://www.w3.org/2005/08/addressing\"&gt;urn:ihe:iti:2007:RetrieveDocumentSet&lt;/Action&gt;\n    &lt;MessageID xmlns=\"http://www.w3.org/2005/08/addressing\"&gt;urn:uuid:361adfb8-e9fd-43a3-b295-6fbd4d96394a&lt;/MessageID&gt;\n    &lt;To xmlns=\"http://www.w3.org/2005/08/addressing\"&gt;https://test.ahdis.ch/eprik-cara/camel/pmp-int/mag-pmp-int/pmp/services/xds/iti43&lt;/To&gt;\n    &lt;ReplyTo xmlns=\"http://www.w3.org/2005/08/addressing\"&gt;\n      &lt;Address&gt;http://www.w3.org/2005/08/addressing/anonymous&lt;/Address&gt;\n    &lt;/ReplyTo&gt;\n  &lt;/soap:Header&gt;\n  &lt;soap:Body&gt;\n    &lt;xds:RetrieveDocumentSetRequest xmlns:rmd=\"urn:ihe:iti:rmd:2017\" xmlns:lcm=\"urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0\" xmlns:query=\"urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0\" xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\" xmlns:xds=\"urn:ihe:iti:xds-b:2007\" xmlns:rs=\"urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0\"&gt;\n      &lt;xds:DocumentRequest&gt;\n        &lt;xds:RepositoryUniqueId&gt;2.16.756.5.30.1.1625.3.1.2.2&lt;/xds:RepositoryUniqueId&gt;\n        &lt;xds:DocumentUniqueId&gt;urn:uuid:14553069-399b-4845-ba35-30612e14e115&lt;/xds:DocumentUniqueId&gt;\n      &lt;/xds:DocumentRequest&gt;\n    &lt;/xds:RetrieveDocumentSetRequest&gt;\n  &lt;/soap:Body&gt;\n&lt;/soap:Envelope&gt;\n\n--uuid:fe38a46e-a89a-4810-856a-28f5b866b9d8--\n</code></pre></p>"},{"location":"transactions/iti43/#response","title":"Response","text":"<p><code>Header</code> <pre><code>200 \nConnection: Keep-Alive\nContent-Type: multipart/related; type=\"application/xop+xml\"; boundary=\"uuid:257c3e80-0248-4d19-aeec-f81366d06e54\"; start=\"&lt;root.message@cxf.apache.org&gt;\"; start-info=\"application/soap+xml\"\nDate: Fri, 24 Oct 2025 14:11:00 GMT\nKeep-Alive: timeout=5, max=99\nServer: Apache\nTransfer-Encoding: chunked\n</code></pre></p> <p><code>Body</code> <pre><code>--uuid:257c3e80-0248-4d19-aeec-f81366d06e54\nContent-Type: application/xop+xml; charset=UTF-8; type=\"application/soap+xml\"\nContent-Transfer-Encoding: binary\nContent-ID: &lt;root.message@cxf.apache.org&gt;\n\n&lt;soap:Envelope xmlns:soap=\"http://www.w3.org/2003/05/soap-envelope\"&gt;\n  &lt;soap:Header&gt;\n    &lt;Action xmlns=\"http://www.w3.org/2005/08/addressing\"&gt;urn:ihe:iti:2007:RetrieveDocumentSetResponse&lt;/Action&gt;\n    &lt;MessageID xmlns=\"http://www.w3.org/2005/08/addressing\"&gt;urn:uuid:913a5539-f67b-4c94-8d9d-803e68714cb4&lt;/MessageID&gt;\n    &lt;To xmlns=\"http://www.w3.org/2005/08/addressing\"&gt;http://www.w3.org/2005/08/addressing/anonymous&lt;/To&gt;\n    &lt;RelatesTo xmlns=\"http://www.w3.org/2005/08/addressing\"&gt;urn:uuid:361adfb8-e9fd-43a3-b295-6fbd4d96394a&lt;/RelatesTo&gt;\n  &lt;/soap:Header&gt;\n  &lt;soap:Body&gt;\n    &lt;xds:RetrieveDocumentSetResponse xmlns:rmd=\"urn:ihe:iti:rmd:2017\" xmlns:lcm=\"urn:oasis:names:tc:ebxml-regrep:xsd:lcm:3.0\" xmlns:query=\"urn:oasis:names:tc:ebxml-regrep:xsd:query:3.0\" xmlns=\"urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0\" xmlns:xds=\"urn:ihe:iti:xds-b:2007\" xmlns:rs=\"urn:oasis:names:tc:ebxml-regrep:xsd:rs:3.0\"&gt;\n      &lt;rs:RegistryResponse status=\"urn:oasis:names:tc:ebxml-regrep:ResponseStatusType:Success\"/&gt;\n      &lt;xds:DocumentResponse&gt;\n        &lt;xds:RepositoryUniqueId&gt;2.16.756.5.30.1.1625.3.1.2.2&lt;/xds:RepositoryUniqueId&gt;\n        &lt;xds:DocumentUniqueId&gt;urn:uuid:14553069-399b-4845-ba35-30612e14e115&lt;/xds:DocumentUniqueId&gt;\n        &lt;xds:mimeType&gt;application/json+fhir&lt;/xds:mimeType&gt;\n        &lt;xds:Document&gt;\n          &lt;xop:Include xmlns:xop=\"http://www.w3.org/2004/08/xop/include\" href=\"cid:a3062b13-58e7-4516-872e-fa67ec6a86ad-91@urn%3Aihe%3Aiti%3Axds-b%3A2007\"/&gt;\n        &lt;/xds:Document&gt;\n      &lt;/xds:DocumentResponse&gt;\n    &lt;/xds:RetrieveDocumentSetResponse&gt;\n  &lt;/soap:Body&gt;\n&lt;/soap:Envelope&gt;\n\n--uuid:257c3e80-0248-4d19-aeec-f81366d06e54\nContent-Type: application/json+fhir\nContent-Transfer-Encoding: binary\nContent-ID: &lt;a3062b13-58e7-4516-872e-fa67ec6a86ad-91@urn:ihe:iti:xds-b:2007&gt;\n\n{\n  \"resourceType\": \"Bundle\",\n  \"meta\": {\n    \"profile\": [\n      \"http://fhir.ch/ig/ch-emed-epr/StructureDefinition/ch-emed-epr-document-medicationcard\"\n    ]\n  },\n  \"identifier\": {\n    \"system\": \"urn:ietf:rfc:3986\",\n    \"value\": \"urn:uuid:14553069-399b-4845-ba35-30612e14e115\"\n  },\n  \"type\": \"document\",\n  \"timestamp\": \"2025-10-24T16:10:59.765+02:00\",\n  \"entry\": [Content removed for better readability]\n}\n--uuid:257c3e80-0248-4d19-aeec-f81366d06e54--\n</code></pre></p>"},{"location":"transactions/iti43/#error-codes","title":"Error codes","text":"<p>All of these can be errors or warnings.</p> Error code Description XDSDocumentUniqueIdError The document associated with the uniqueId is not available. This could be because the document is not available, the requestor is not authorized to access that document or the document is no longer available. XDSMissingHomeCommunityId A value for the homeCommunityId is required and has not been specified. XDSRegistryBusy XDSRepositoryBusy Too much activity. (Not used now) XDSRegistryError XDSRepositoryError Internal Error. The error codes XDSRegistryError or XDSRepositoryError shall be returned if and only if a more detailed code is not available. XDSRegistryOutOfResources XDSRepositoryOutOfResources Resources are low. (Not used now) XDSResultNotSinglePatient This error signals that a single request would have returned content for multiple Patient Ids. TODO: that would leak that the ID exists and belongs to another patient. For privacy reasons, would it be treated like a non-existing document? If yes, this error wouldn\u2019t be possible. XDSUnavailableCommunity A community that was queried was not available. XDSUnknownCommunity A value for the homeCommunityId is not recognized. XDSUnknownRepositoryId The repositoryUniqueId value could not be resolved to a valid document repository or the value does not match the repositoryUniqueId."},{"location":"transactions/iti44/","title":"Patient Identity Feed HL7 V3 [ITI-44]","text":"<p>The eMedication service exposes an ITI-44 endpoint (see endpoints) that allows clients to register a patient in the eMedication\u2019s own PIX service.</p> <p>The transaction follows the IHE profile specifications, with the following particularities:</p> <ul> <li>Only <code>Patient Registry Record Added</code> messages are supported.</li> <li>Swiss EPR restrictions to the <code>Patient Registry Record Added</code> message, as per the Swiss National Extensions to the IHE Technical Framework, section 1.7.<ul> <li>[\u00a7 1.7.1] Must contain the patient\u2019s EPR-SPID.</li> <li>[\u00a7 1.7.1] Must contain an additional patient id to the EPR-SPID. In the context of the eMedication service, this can be for instance CARA\u2019s MPI-PID.</li> <li>[\u00a7 1.7.1] No <code>religiousAffiliationCode</code> allowed.</li> <li>[\u00a7 1.7.1] No <code>raceCode</code> allowed.</li> <li>[\u00a7 1.7.1] No <code>ethnicGroupCode</code> allowed.</li> <li>[\u00a7 1.7.1] No <code>personalRelationship</code> allowed.</li> </ul> </li> <li>Note that different environments might use different OIDs for the assigning authorities. See the OIDs page.</li> <li>Upon receiving the message, the eMedication service will act int he following manner:<ul> <li>If the eMedication\u2019s PIX service recognizes the patient\u2019s EPR-SPID, the patient is already registered in the service and it will return an <code>OK</code> code with a detail stating that the registration existed already.</li> <li>If the patient is not currently registered in the eMedication service:<ul> <li>If the patient has a PMP-PID registered in the CARA\u2019s MPI already, the eMedication service will create a new eMedication registration with this existing PMP-PID and return <code>OK</code> with proper detail.</li> <li>If the patient does not have a PMP-PID in CARA\u2019s MPI:<ul> <li>If the patient is nevertheless registered in CARA\u2019s MPI, meaning it has a CARA MPI-PID, the eMedication service will assign a new PMP-PID to the patient, register it in CARA\u2019s MPI and create an eMedication registration for the patient with the associated PMP-PID. The response will have an <code>OK</code> code and proper detail.</li> <li>If the patient is not registered at all in CARA\u2019s MPI, the eMedication service will assign a new PMP-PID to the patient, the eMedication service will create a new registration for this patient in CARA\u2019s MPI with the associated PMP-PID and finally create an eMedication registration with the associated PMP-PID. The response will have an <code>OK</code> code with proper detail. Note that this is the only case in which the patient information conveyed with the <code>Patient Registry Record Added</code> message, other than the patient ids, will be used.</li> </ul> </li> </ul> </li> </ul> </li> </ul> <p>Warning</p> <p>Please note that the enrollment process will not be completed until an APPC document has been provided after adding the patient to the eMedication PIX service. Clients shall not start an ITI-44 transaction unless they can provide an APPC document for the patient immediately after successfully finishing this PIX feed transaction.</p>"},{"location":"transactions/iti45/","title":"PIXV3 Query [ITI-45]","text":"<p>The eMedication service exposes an ITI-45 endpoint (see endpoints) that allows clients to query the service for patient ids of registered patients, that is, patients currently enrolled in the eMedication service.</p> <p>This transaction follows IHE\u2019s specifications with the following particularities:</p> <ul> <li>The eMedication service recognizes 3 possible data sources for patient ids (see OIDs for actual values):<ul> <li>CARA\u2019s assigning authority.</li> <li>The Swiss Central Compensation Office\u2019s assignign authority.</li> <li>The eMedication service\u2019s own assigning authority.</li> </ul> </li> </ul> <p>Warning</p> <p>Please note that even though the PMP-PIDs are added and stored as well in CARA\u2019s MPI, clients are encouraged to query the eMedication PIX service to query for (or confirm) the PMP-PID. This is because CARA\u2019s MPI might contain PMP-PIDs for patients that are no longer enrolled in the eMedication service and while the eMedicaiton PIX service will no longer recognize such patient ids, CARA\u2019s PIX service will continue to return those.</p> <p>Warning</p> <p>A patient\u2019s enrollment in the eMedication service requires registration in its PIX service as well as a valid APPC document.</p>"},{"location":"transactions/iti57/","title":"ITI-57","text":"<p>The ITI-57 (Update Document Set) transaction makes it possible to update existing documents. </p>"},{"location":"transactions/iti57/#update-documententry-metadata","title":"Update DocumentEntry Metadata","text":"<p>This transaction is implemented, but only for the deletionStatus attribute. This implies that the only possible update in the service is the deletion of a document.</p>"},{"location":"transactions/iti57/#deleting-a-ch-emed-epr-document","title":"Deleting a CH EMED EPR document","text":"<p>The rules are similar to ITI-41 replacement.</p> <ul> <li>Patient / representative can only request the removal of a document published by the same patient. Hence a patient cannot request the removal of a document published by a healthcare professional.<ul> <li>Representatives are not supported by the service yet, but will be in the future.</li> </ul> </li> <li>Healthcare professionals can only request the removal of a document published by themselves or by another healthcare professional of the same community of affiliation.<ul> <li>Deletion rights related to HCP are not implemented yet and will be subject to further discussion before implementation. For now, patients are allowed to delete documents provided by HCPs and HCPs are not allowed to delete any documents.</li> </ul> </li> <li>Document administrator may only request the removal of any document published by either a patient, representative, or healthcare professional.</li> <li>Only approved documents at the end of a treatment chain can be requested to be deleted.</li> <li>Requested deletion of a CH EMED EPR document will also flag for deletion the chain of replaced documents by this document, if it exists.</li> <li>Documents to be deleted must exist in the repository.</li> <li>Currently the service just permanently deletes the requested documents, no archival or flagging is done.</li> </ul>"},{"location":"transactions/iti57/#deleting-an-appc-document","title":"Deleting an APPC document","text":"<ul> <li>Deleting an APPC document means that the patient is opting out. It triggers an archive and removal of all the documents for this patient: CH EMED EPR and APPC (including and any deprecated ones) documents are both concerned.</li> <li>Only the patients or their representatives can request the deletion of their own APPC documents.</li> <li>A policy administrator can request the removal of any patient\u2019s APPC of their own reference community.</li> <li>The APPC document has to be approved<ul> <li>This implies that direct deletion of a deprecated (replaced) APPC document is not possible.</li> <li>Unapproved APPC document deletion can only occur at opt-out.</li> </ul> </li> <li>Currently the service just permanently deletes the requested APPC document and all the CH EMED EPR documents and any other information stored by the PMP concerning this patient, no archival or flagging is done.</li> </ul>"},{"location":"transactions/iti57/#update-documententry-availabilitystatus","title":"Update DocumentEntry availabilityStatus","text":"<p>This transaction is unsupported for eMed and policy documents.</p>"},{"location":"transactions/iti57/#update-folder-metadata","title":"Update Folder Metadata","text":"<p>This is unsupported, as the service doesn\u2019t support folders.</p>"},{"location":"transactions/iti57/#update-folder-availabilitystatus","title":"Update Folder availabilityStatus","text":"<p>This is unsupported, as the service doesn\u2019t support folders.</p>"},{"location":"transactions/iti57/#update-association-availabilitystatus","title":"Update Association availabilityStatus","text":"<p>This is unsupported.</p>"},{"location":"transactions/iti57/#submit-associations","title":"Submit Associations","text":"<p>This is unsupported.</p>"},{"location":"transactions/iti57/#error-codes","title":"Error codes","text":"<p>The resulting status shall be Success or Failure. PartialSuccess shall not be used.</p> Error Code Reasons XDSMetadataUpdateError General metadata update error. XDSPatientIDReconciliationError Update encountered error where Patient IDs did not match. Not allowed. XDSMetadataUpdateOperationError Document Registry cannot decode the requested metadata update. XDSMetadataVersionError The version number included in the update request did not match the existing object. <p>Common errors and proposed error codes:</p> <ul> <li>The operation is unsupported: (not seen in the spec) XDSMetadataUpdateOperationError</li> <li>Trying to set the deletionStatus to deletionProhibited: Error or OperationError? </li> </ul>"},{"location":"transactions/iti65/","title":"ITI-65","text":"<p>The ITI-65 (Provide Document Bundle) transaction allows a Document Source (e.g. a primary system) to send a document with its associated metadata to the Document Recipient (i.e. the eMedication service backend).</p> <p>This transaction provides an MHD-based alternative, as profiled by CH EPR FHIR, to the ITI-41 transaction, and the same metadata and business logic constraints defined for that transaction on our service guide apply.</p>"},{"location":"transactions/iti65/#security-considerations","title":"Security Considerations","text":"<p>Note that beside the security considerations expressed (directly or indirectly) by the CH EPR FHIR profile, the eMedication service implementation supports only, for now, the SAML Token option, which means that the authorization token conveyed with the HTTP request must be an XUA token.</p>"},{"location":"transactions/iti67/","title":"ITI-67","text":"<p>The ITI-67 (Find Document References) transaction allows Document Consumer actors (e.g. primary systems) to query a Document Responder (i.e. the eMedication service backend) for a list of <code>DocumentReference</code> resources that satisfy a set of parameters.</p> <p>This transaction provides an MHD-based alternative, as profiled by CH EPR FHIR to the ITI-18 (Registry Stored Query) transaction. Note that metadata and business logic constraints on ITI-18 for the eMedication service apply as well for this transaction.</p> <p>The result of the query is a Bundle (so not directly a collection) containing the DocumentReference resources that match the query parameters (if any).</p>"},{"location":"transactions/iti67/#further-constraints","title":"Further Constraints","text":"<p>The eMedication service does not for now support the <code>identifier</code> parameter. Note that this parameter is in fact not required by the <code>XDS on FHIR</code> option to which the eMedication service is grouped with and whose list of mapped parameters are the ones supported by the service.</p>"},{"location":"transactions/iti67/#security-considerations","title":"Security Considerations","text":"<p>Note that beside the security considerations expressed (directly or indirectly) by the CH EPR FHIR profile, the eMedication service implementation supports only, for now, the SAML Token option, which means that the authorization token conveyed with the HTTP request must be an XUA token.</p>"},{"location":"transactions/iti68/","title":"ITI-68","text":"<p>The ITI-68 (Retrieve Document) transaction allows a Document Consumer (e.g. a primary system) to retrieve a document from the Document Responder (i.e. the eMedication service) as specified by the CH EPR FHIR implementation guide.</p> <p>This transaction provides an MHD-based alternative, as profiled by CH EPR FHIR to the ITI-43 transaction. Note that the same restrictions and business logic as for said XDS transaction apply to this MHD equivalent.</p>"},{"location":"transactions/iti68/#security-considerations","title":"Security Considerations","text":"<p>Note that beside the security considerations expressed (directly or indirectly) by the CH EPR FHIR profile, the eMedication service implementation supports only, for now, the SAML Token option, which means that the authorization token conveyed with the HTTP request must be an XUA token.</p>"},{"location":"transactions/iti83/","title":"ITI-83","text":"<p>The ITI-83 (Mobile Patient Identifier Cross-reference Query) transaction allows a Patient Identifier Cross-reference Consumer (e.g. a primary system app) to query the Patient Identifier Cross-reference Manager (i.e. the eMedication service) for patient identifiers.</p> <p>This transaction, based directly on IHE\u2019s PIXm profile and not on the CH EPR FHIR equivalent, provides a RESTful alternative to the ITI-45 transaction. The same business logic and constraints apply.</p>"},{"location":"transactions/iti83/#security-considerations","title":"Security Considerations","text":"<p>This transaction requires no authorization token, neither JWT nor XUA.</p>"},{"location":"workflows/","title":"Treatment lifecycle","text":"<p>The diagram below shows the different steps in a treatment\u2019s lifecycle, as well as the associated transactions. </p>"},{"location":"workflows/aggregation/","title":"Aggregation","text":""},{"location":"workflows/aggregation/#concepts","title":"Concepts","text":"Term Definition References Medication plan (current medication) The medication plan is the documentation of all the medication information for a patient at a certain point of time.The medication plan can be presented as a medication card or as an eMediplan (eMediplan is not supported by the service, it is another way of displaying the medication plan). See IHE Pharmacy Community Medication List (PML) and IPAG\u2019s definition (FR, DE), \u00a7 2.1 and \u00a7 2.5. Medication treatment A medication treatment corresponds to one single medication the patient was planned to take in the past or is planned to take presently or in the future, including its name, dosage, frequency of intake, etc.Medication treatments are created every time an MTP document is received. This service considers two kinds of medication treatments: \u201csimple\u201d and \u201cprescribed\u201d. Simple medication treatments are created with just one MTP document (by the patient or a healthcare professional). Prescribed medication treatments are created by healthcare professionals only, with an MTP document followed by a PRE document. See IHE Pharmacy MTP supplement, as well as HL7\u2019s Medication Treatment Plan FHIR document. Medication treatment instance A medication treatment instance is a concept of this eMedication service.  A medication treatment can change over time: the dosage, medication, active substance, comments, etc. can be updated. The medication treatment instance represents the state of a medication at a current point of time. Medication treatment instance creation depends on the type of medication treatment. For \u201csimple\u201d (ie. not prescribed) treatments, a single medication treatment instance is created when the MTP document is received.  For prescribed medication treatments (ie. medication treatments for which there is a MTP document and at least one  PRE document), a new instance is created every time a PRE document is received.Each medication treatment instance appears in a single line within the medication card. Instances associated with the same treatment are visually grouped. - Medication statement A medication statement represents a given medication (form, dosage, GTIN/ATC, ingredients etc.) See the definition in the implementation guide. Aggregation The aggregation is the process of determining the current state of each medication treatment within a patient\u2019s medication plan, based on the existing medication treatment instances.This is done depending on the document triggering the aggregation, either by updating existing medication treatments /  medication treatment instances, or by creating new medication treatment instances -"},{"location":"workflows/aggregation/#triggers","title":"Triggers","text":"<p>Aggregation occurs when:</p> <ul> <li>A new emed document is provided via the ITI-41 transaction.</li> <li>An emed document is removed via the ITI-57 transaction.</li> <li>An emed document is replaced via the ITI-41 transaction and the replace association.</li> </ul>"},{"location":"workflows/aggregation/#scope","title":"Scope","text":"<p>When triggered, aggregation occurs for the medication treatment referenced by the triggering document.</p> <p>When the triggering document is a PRE, it might reference several medication treatments (multi-prescription). In this case the service applies the aggregation process to each referenced medication treatment.</p>"},{"location":"workflows/aggregation/#aggregation-process","title":"Aggregation process","text":""},{"location":"workflows/aggregation/#overview","title":"Overview","text":"<p>The table below shows an overview of the elements updated or created during the aggregation process.</p> Document triggering the aggregation MTP PRE DIS PADV Attribute Description Reference on medication card COMMENT OK SUSPEND CHANGE CANCEL REFUSE Target MTP Target any other document Target MTP Target PRE Can only target MTP Target MTP Target PRE Target MTP Target PRE Target MTP Target PRE Medication treatment Operation Create new Medication Treatment. Retrieve instance(s) associated with referenced treatment and         patient. Retrieve instance associated with referenced treatment and         patient.          Validate that the incoming dispense references a prescription if the         medication treatment is in prescribed state. Retrieve instance associated with referenced treatment and         patient. comments The list of comments made on the treatment itself (referencing         the MTP entry). Prescription comments will be recorded on the medication         treatment instance. 7 - - - Add comment from PADV. - Add comment from PADV. - Add comment from PADV. Add comment from PADV. - Add comment from PADV. - Add comment from PADV. - dispenses The list of dispenses targeting the MTP associated with this         treatment, or any of its related PRE. - - - Add new dispense entry referencing incoming DIS document. - - - - - - - - - - - instances The list of medication treatment instances associated with this         medication treatment. - Add new instance. Add new instance if the treatment is \"prescribed\" (ie.         There is already a Medication treatment instance related to a PRE associated         with this medication treatment). - - - - - - - - - - - - id Globally unique id of this medication treatment. - Initialize withg MTP treatment id. - - - - - - - - - - - - - mpiPid Reference to patient. 1 Initialize with MTP's patient reference. - - - - - - - - - - - - - mtpReference Reference to the MTP associated with this medication treatment. 4 Initialize with reference to incoming MTP. - - - - - - - - - - - - - status Status of the treatment. Can be active, suspended, canceled or         refused.         The status is not shown on the medication card, it is used to select the         treatments to display. - Initialize \"active\". Check value: must be active (not updated). - - - Set \"active\" if it was \"active\" or         \"suspended\". - Set to \"suspended\" document referenced by PADV is a MTP         and if it was in \"active\" state. Set \"active\" if previous value was \"active\" or \"suspended\". - Set \"cancel\" if previous value was not         \"active\" or \"suspended\". - Set \"refused\" if previous value was not         \"active\" or \"suspended\". - startDate The date of the beginning of the treatment. Can be the dosage         start date if it is defined, or the MTP effective time. - Initialize with the MTP's effective periode start time if         defined, with the creation date of the MTP document otherwise. - - - - - - - - - - - - - stopDate The date at which the treatment was stopped (canceled or         refused). - - - - - - - - - - - Set PADV document date - Set PADV document date - Medication treatment instance Operation Create new Medication Treatment instance. <ul> <li>Retrieve existing             Medication Treatment instance if treatment is \"simple\" (ie. This is             the first PRE for this treatment).</li> <li>Create new Medication Treatment instance if treatment is             \"prescribed\" (ie. There is already a PRE for this treatment).</li> </ul> <ul> <li>If incoming DIS is             associated with a prescription, retrieve the medication treatment instance of             the medication treatment, associated with the DIS's prescription.</li> <li>The first medication treatment instance of this medication treatment             otherwise (ensure it exists).</li> </ul> - Retrieve         existing medication treatment instance associated with PADV target document. - Retrieve         existing medication treatment instance associated with PADV's target PRE. - Retrieves         first medication treatment instance associated with target MTP. Retrieves         instance associated with PADV's medication request if PADV targets a PRE. Retrieves all         instances associated with MTP's medication treatment. Retrieve existing medication         treatment instance associated with PADV's target PRE. Retrieves all         instances associated with MTP's medication treatment. - additionalDosages Additional entry of the dosage instruction. 6 Initialize with incoming MTP's medication additional dosages. Add PRE's medication request additional dosages. Checks if existing dosage is equal to incoming DIS dosage.         Update additional dosages with DIS's medication dispense additional dosages         if necessary. - - - - - Set PADV's medication statement additional dosage. Add PADV's medication statement additional dosage. - - - - comments The list of comments associated with this medication treatment         instance (PADV referencing the PRE associated with this instance). 7 - - - - Add PADV comment. - Add PADV comment. - - Add PADV comment. - Add PADV comment. - Add PADV comment. entryReferences The list of entries (documents) that have been aggregated in this         medication treatment instance. - Initialize with reference to incoming MTP. Add reference to incoming PRE. Add reference to incoming DIS. - - - - - - - - - - - baseDosage The dosage instruction for this instance. 6         5 (start and end date of dosage) Initialize with incoming MTP's medication base dosage. Set PRE's medication request base dosage. Checks if existing dosage is equal to incoming DIS dosage.         Update base dosage with DIS's medication dispense dosage if necessary. - - - - - Set PADV's medication statement base dosage. - - - - id Globally unique id of this medication treatment instance. - Initialize with MTP treatment id. Set PRE's medication request id. - - - - - - - - - - - - inReserve Flag indicating whether this treatment is in reserve or not. 9 Initialize with value from MTP. Set to PRE's medication request \"is as needed\" value. - - - - - - Set PADV's medication as needed flag value. - - - - lastInterveningAuthor The author of the last item entry (of any kind) in this         treatment. This is the last intervening. - Initialize with MTP document author. Set PRE document author. Set DIS document author. Set PADV document author. lastMedicalAuthor The author of the last item entry (of type MTP, PRE, or any type         of PADV except COMMENT that apply to an MTP or PRE) in this treatment. This         is the last \"medical\" participant. 2 Initialize with MTP's medication statement entry author. Set PRE medication request entry author. Set DIS medication dispense author. Set PADV comment author. medication The medication associated with this treatment. 4 Initialize with incoming MTP medication. Set medication from PRE's medication request. Set medication from DIS's medication dispense. - - - - - Set PADV's medication. - - - - preReference Reference to the PRE document associated with this instance. - - Set reference to incoming PRE. - - - - - - - - - - - - preStartTime Prescription validity         start time, inclusive (the first time the prescription may be dispensed). - - - - - - - - - - - - - - - preStopTime Prescription validity stop time, inclusive.         the last time the prescription may be dispensed. No limit is implemented in         this service. - - - - - - - - - - - - - - - reason The reason for the treatment. 7 Initialize with incoming MTP's medication reason code. Set PRE's medication request reason code. - - - - - - Set PADV's medication reason code. - - - - status The status of the prescription associated with this instance.         Can be submitted, provisional, active, canceled or refused.         The status is not shown on the medication card, it is used to select the         treatment instances to display. - Initialize \"active\". Set \"submitted\". - - - - Set \"active\" current status is not         \"submitted\" or \"provisional\". - - Set \"active\" if previous value was         \"submitted\". Set \"cancel\" if previous value was         not \"refused\". Set \"refused\" if previous value was         not \"refused\". stopDate The date at which the treatment instance was stopped (canceled         or refused). - - - - - - - - - - - Set PADV document date. Set PADV document date. substitutionPermitted Flag indicating whether a substitute (generics) may be dispensed         for this treatment or not. - Initialize \"true\". Set to \"true\" if PRE's medication request         \"resolve substitution\" attribute is \"equivalent\". - - - - - - Set to \"true\" if PADV's medication         request \"resolve substitution\" attribute is \"equivalent\". - - - -"},{"location":"workflows/aggregation/#medication-card","title":"Medication card","text":""},{"location":"workflows/situationalworkflows/","title":"Situational workflows","text":"<p>This page describes possible interactions between third party applications and the eMedication service in different situations (medical consultation, medication dispense at a pharmacy, visit at a hospital etc.). </p> <p>For each situation, and corresponding types of eMedication service clients, it details the documents that can be exchanged and the corresponding transactions.</p> <p>A detailed documentation on the documents is available on the CH EMED EPR FHIR implementation guide (IG).</p> <p>The supported documents are:</p> <ul> <li>MTP (Medication Treatment Plan) IHE Definition - CH EMED EPR IG: introducing a treatment in the plan.</li> <li>PRE (Prescription) IHE Definition - CH EMED EPR IG: prescribing a medication.</li> <li>DIS (Dispense) IHE Definition - CH EMED EPR IG: dispensing a medication.</li> <li>PADV (Pharmaceutical advice) IHE Definition - CH EMED EPR IG: modifying the state of the treatment or adding a comment.</li> <li>PML (Medication list) IHE Definition - CH EMED EPR IG: listing multiple medication entries in a single document. This document can only be retrieved from the medication service. It is not possible to publish it.</li> <li>PMLc (Medication card) IHE Definition - CH EMED EPR IG: listing the on-going treatments in an aggregated form. This document can only be retrieved from the medication service. It is not possible to publish it.</li> </ul>"},{"location":"workflows/situationalworkflows/#workflows","title":"Workflows","text":""},{"location":"workflows/situationalworkflows/#exchanging-documents","title":"Exchanging documents","text":"<p>Interacting with the eMedication service essentially comes down to:</p> <ul> <li>Publishing documents (MTP (Medication Treatment Plan), PRE (Prescription), DIS (Dispense), PADV (Pharmaceutical advice)), with the ITI-41 (publish document) transaction.</li> <li>Retrieving the medication list (PML (Medication list)), or card (PMLc (Medication card)), with a combination of CH:PHARM-1 (search pharmacy documents) and ITI-43 (retrieve document) transactions:<ul> <li>CH:PHARM-1 (search pharmacy documents ) is used to get a reference to the medication list (or card) document, through the <code>FindMedicationList</code> (or <code>FindMedicationCard</code>) query.</li> <li>ITI-43 (retrieve document) is used to retrieve the document, based on the reference obtained above. The document is generated on demand by the service.</li> </ul> </li> </ul>"},{"location":"workflows/situationalworkflows/#situational-examples","title":"Situational examples","text":""},{"location":"workflows/situationalworkflows/#prescriber-workflow","title":"Prescriber workflow","text":"<p>During a medical consultation, the typical workflow for a prescriber (medical practitioner), and the corresponding transactions would be:</p> <ul> <li>To check the current medication of a patient during the anamnesis.<ul> <li>Import PMLC (Medication card) to retrieve the current medication plan (CH:PHARM-1 (<code>FindMedicationCard</code>) then ITI-43 (retrieve document)).</li> </ul> </li> <li>To prescribe new medication.<ul> <li>Export MTP (Medication Treatment Plan) for each new medication introduced into the plan (ITI-41 (publish document)).</li> <li>PRE (Prescription) to issue a new prescription.</li> </ul> </li> <li>To provide pharmaceutical advice about the treatment (ITI-41 (publish document)).<ul> <li>PADV (Pharmaceutical advice) COMMENT to add a comment on a MTP entry (ITI-41 (publish document)).</li> </ul> </li> </ul>"},{"location":"workflows/situationalworkflows/#dispenser-workflow","title":"Dispenser workflow","text":"<p>While visiting a pharmacy after a medical consultation, a patient and a pharmacist (dispenser) may have a conversation related to the current medication of the patient, the new treatments prescribed, possible drug substitutions (use of generic drug, change of the dosage form) and possible addition of new medications to the prescription.</p> <p>The typical workflow for a pharmacist (dispenser), and the corresponding transactions would be:</p> <ul> <li>To check the current medication of a patient.<ul> <li>Import PMLC (Medication card) (or PML (Medication list) if history is needed) to retrieve the current medication plan (CH:PHARM-1 (<code>FindMedicationCard</code>) then ITI-43 (retrieve document)).</li> </ul> </li> <li>To update the medication plan in case it is not up-to-date (for instance a new prescription has been issued by a prescriber not connected to the eMedication service).<ul> <li>Export MTP (Medication Treatment Plan) for each treatment not in the plan to introduce it into it (ITI-41 (publish document)).</li> <li>PADV (Pharmaceutical advice).<ul> <li>CANCEL for each MTP entry that is no longer active (ITI-41 (publish document)).</li> </ul> </li> </ul> </li> <li>To check and confirm the prescription made by the prescriber.<ul> <li>PADV (Pharmaceutical advice).<ul> <li>OK for each PRE (Prescription) entry of the prescription that can be dispensed (ITI-41 (publish document)).</li> <li>REFUSE for each PRE (Prescription) entry of the prescription that cannot be dispensed (ITI-41 (publish document)).</li> </ul> </li> </ul> </li> <li>To prescribe new medication.<ul> <li>Export MTP (Medication Treatment Plan) for each new treatment to introduce them into the plan (ITI-41 (publish document)).</li> <li>PRE (Prescription) for each medication prescribed by the dispenser (ITI-41 (publish document)).    </li> </ul> </li> <li>To dispense the prescribed medication or appropriate generics, possibly changing the dosage form.<ul> <li>DIS (Dispense) for each medication actually dispensed.</li> </ul> </li> <li>To generate a medication card for the patient (ITI-41 (publish document)).<ul> <li>Import PMLc (Medication card) to create a document describing the new actual medication of the patient (CH:PHARM-1 (<code>FindMedicationCard</code>) then ITI-43 (retrieve document)).</li> </ul> </li> </ul>"},{"location":"workflows/situationalworkflows/#medication-manager-workflow","title":"Medication manager workflow","text":"<p>The medication manager helps patients having difficulties with their own medications. Their role is mainly to monitor and assist patients with their medications. The workflow and transactions for medication managers is essentially the same as for patients (see below).</p>"},{"location":"workflows/situationalworkflows/#patient-workflow","title":"Patient workflow","text":"<p>In addition to checking it, a patient can update its own medication plan, to add comments on the medication, introduce self-medication or indicate that he or she has stopped taking a medication. There is no specific workflow, but the transactions could be:</p> <ul> <li>To generate a medication card.<ul> <li>Import PMLc (Medication card) to create a document describing the new actual medication (CH:PHARM-1 (<code>FindMedicationCard</code>) then ITI-43 (retrieve document)).</li> </ul> </li> <li>To add self-medication treatments.<ul> <li>Export MTP (Medication Treatment Plan) for each new self-medication treatment (ITI-41 (publish document)).</li> </ul> </li> <li>To update existing self-medication treatments or add a comment on any treatment.<ul> <li>PADV (Pharmaceutical advice).<ul> <li>SUSPEND for each MTP entry the patient is no longer taking (ITI-41 (publish document)).</li> <li>COMMENT possibly on each MTP entry, to add details, or explain the reasons of a SUSPEND (ITI-41 (publish document)).</li> </ul> </li> </ul> </li> </ul>"},{"location":"workflows/situationalworkflows/#hospital-workflow","title":"Hospital workflow","text":"<p>During a visit at a hospital, the medication is handled by the hospital\u2019s information system. Interactions with the e-medication service typically happen at admission and release.</p>"},{"location":"workflows/situationalworkflows/#admission","title":"Admission","text":"<p>The typical workflow at admission, and the corresponding transactions would be:</p> <ul> <li>To check the current medication of a patient.<ul> <li>Import PMLC (Medication card) to retrieve the current medication plan (CH:PHARM-1 (<code>FindMedicationCard</code>) then ITI-43 (retrieve document)).</li> </ul> </li> <li>To update the medication plan in case it is not up-to-date (for instance a new prescription has been issued by a prescriber not connected to the eMedication service) (ITI-41 (publish document)).<ul> <li>Export MTP (Medication Treatment Plan) for each  treatment not in the plan to introduce it into it (ITI-41 (publish document)).</li> <li>PADV (Pharmaceutical advice).<ul> <li>CANCEL for each MTP entry that is no longer active (ITI-41 (publish document)).</li> <li>SUSPEND for each MTP entry that should be suspended (ITI-41 (publish document)).</li> </ul> </li> </ul> </li> </ul>"},{"location":"workflows/situationalworkflows/#release","title":"Release","text":"<p>At release, the medication plan might be entirely revised: former medication stopped or altered, new medication introduced. The typical workflow and corresponding transactions would therefore be a combination of:</p> <ul> <li>Prescribing new medication.<ul> <li>Export MTP (Medication Treatment Plan) for each new medication introduced into the plan (ITI-41 (publish document)).</li> <li>PRE (Prescription) to issue a new prescription (ITI-41 (publish document)).</li> <li>PADV (Pharmaceutical advice) COMMENT possibly on each new MTP entry (ITI-41 (publish document)).</li> </ul> </li> <li>Updating former medication<ul> <li>PADV (Pharmaceutical advice) CANCEL for each former MTP entry whose treatment should be permanently canceled. (ITI-41 (publish document)).</li> <li>PADV (Pharmaceutical advice) CHANGE for each former MTP entry that should be updated (ITI-41 (publish document)).</li> <li>PADV (Pharmaceutical advice) OK for each former MTP entry whose treatment was suspended and should be now resumed (ITI-41 (publish document)).</li> </ul> </li> <li>Generating a medication card for the patient.<ul> <li>Import PMLC (Medication card) to create a document describing the new actual medication of the patient (CH:PHARM-1 (<code>FindMedicationCard</code>) then ITI-43 (retrieve document)).</li> </ul> </li> </ul>"}]}